var Tt=Object.defineProperty;var ht=Object.getOwnPropertySymbols;var vt=Object.prototype.hasOwnProperty,Et=Object.prototype.propertyIsEnumerable;var tt=(e,t,n)=>t in e?Tt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,et=(e,t)=>{for(var n in t||(t={}))vt.call(t,n)&&tt(e,n,t[n]);if(ht)for(var n of ht(t))Et.call(t,n)&&tt(e,n,t[n]);return e};var D=(e,t,n)=>(tt(e,typeof t!="symbol"?t+"":t,n),n);import{j as nt,r as G,m as dt,l as Ot,s as St,a as rt,d as Bt,z as $t,i as Lt,b as Pt,R as st,c as Gt,e as jt}from"./vendor.81ab7bc9.js";const Ht=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}};Ht();class c{constructor(t,n,r){this.x=t,this.y=n,this.z=r,this.x=t||0,this.y=n||0,this.z=r||0}negative(){return new c(-this.x,-this.y,-this.z)}add(t){return t instanceof c?new c(this.x+t.x,this.y+t.y,this.z+t.z):new c(this.x+t,this.y+t,this.z+t)}subtract(t){return t instanceof c?new c(this.x-t.x,this.y-t.y,this.z-t.z):new c(this.x-t,this.y-t,this.z-t)}multiply(t){return t instanceof c?new c(this.x*t.x,this.y*t.y,this.z*t.z):new c(this.x*t,this.y*t,this.z*t)}divide(t){return t instanceof c?new c(this.x/t.x,this.y/t.y,this.z/t.z):new c(this.x/t,this.y/t,this.z/t)}equals(t){return this.x==t.x&&this.y==t.y&&this.z==t.z}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return new c(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}length(){return Math.sqrt(this.dot(this))}magnitude(){return this.length()}unit(){return this.divide(this.length())}min(){return Math.min(Math.min(this.x,this.y),this.z)}max(){return Math.max(Math.max(this.x,this.y),this.z)}toAngles(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length())}}angleTo(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}toArray(t){return[this.x,this.y,this.z].slice(0,t||3)}toCoord(){return new Z(this.x,this.y,this.z)}clone(){return new c(this.x,this.y,this.z)}init(t,n,r){return this.x=t,this.y=n,this.z=r,this}normalize(){return this.unit()}setIndex(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break}}distanceTo(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)+Math.pow(this.z-t.z,2))}static negative(t,n,r){return n.x=-t.x,n.y=-t.y,n.z=-t.z,n}static add(t,n,r){return n instanceof c?(r.x=t.x+n.x,r.y=t.y+n.y,r.z=t.z+n.z):(r.x=t.x+n,r.y=t.y+n,r.z=t.z+n),r}static subtract(t,n,r){return n instanceof c?(r.x=t.x-n.x,r.y=t.y-n.y,r.z=t.z-n.z):(r.x=t.x-n,r.y=t.y-n,r.z=t.z-n),r}static multiply(t,n,r){return n instanceof c?(r.x=t.x*n.x,r.y=t.y*n.y,r.z=t.z*n.z):(r.x=t.x*n,r.y=t.y*n,r.z=t.z*n),r}static divide(t,n,r){return n instanceof c?(r.x=t.x/n.x,r.y=t.y/n.y,r.z=t.z/n.z):(r.x=t.x/n,r.y=t.y/n,r.z=t.z/n),r}static cross(t,n,r){return r.x=t.y*n.z-t.z*n.y,r.y=t.z*n.x-t.x*n.z,r.z=t.x*n.y-t.y*n.x,r}static unit(t,n,r){var s=t.length();return n.x=t.x/s,n.y=t.y/s,n.z=t.z/s,n}static fromAngles(t,n){return new c(Math.cos(t)*Math.cos(n),Math.sin(n),Math.sin(t)*Math.cos(n))}static randomDirection(){return c.fromAngles(Math.random()*Math.PI*2,Math.asin(Math.random()*2-1))}static min(t,n,r){return new c(Math.min(t.x,n.x),Math.min(t.y,n.y),Math.min(t.z,n.z))}static max(t,n,r){return new c(Math.max(t.x,n.x),Math.max(t.y,n.y),Math.max(t.z,n.z))}static lerp(t,n,r){return n.subtract(t).multiply(r).add(t)}static fromArray(t){return new c(t[0],t[1],t[2])}static angleBetween(t,n,r){return t.angleTo(n)}static infinity(){return new c(1/0,1/0,1/0)}}class Z{constructor(t,n,r){this.x=t,this.y=n,this.z=r}toVec(){return c.fromArray(this.toArray())}toArray(){return[this.x,this.y,this.z]}}var ut;(function(e){e.A="\u03B1",e.B="\u03B2",e.G="\u03B3",e.D="\u03B4",e.E="\u03B5",e.Z="\u03B6",e.H="\u03B7"})(ut||(ut={}));class Ft{constructor(){D(this,"center");D(this,"interactions");D(this,"atoms");D(this,"v");D(this,"o");D(this,"hash");D(this,"name");D(this,"sequenceNumber");D(this,"polymerChainIdentifier");this.atoms=[],this.name="",this.sequenceNumber=-1,this.center=new Z(-1,-1,-1),this.hash="",this.interactions=[],this.polymerChainIdentifier="",this.v=c.infinity(),this.o=c.infinity()}findAtomsByNames(t){let n=[];return this.atoms.forEach(r=>{t.indexOf(r.name)!==-1&&n.push(r)}),n.sort((r,s)=>t.indexOf(r.name)-t.indexOf(s.name)),n}}var x;(function(e){e.DA="DA",e.DG="DG",e.DC="DC",e.DT="DT",e.CM="5CM"})(x||(x={}));var A;(function(e){e.A="A",e.C="C",e.G="G",e.I="I",e.U="U"})(A||(A={}));var ft;(function(e){e[e.Ala=0]="Ala",e[e.Arg=1]="Arg",e[e.Asn=2]="Asn",e[e.Asp=3]="Asp",e[e.Cys=4]="Cys",e[e.Glu=5]="Glu",e[e.Gln=6]="Gln",e[e.Gly=7]="Gly",e[e.His=8]="His",e[e.Ile=9]="Ile",e[e.Leu=10]="Leu",e[e.Lys=11]="Lys",e[e.Met=12]="Met",e[e.Phe=13]="Phe",e[e.Pro=14]="Pro",e[e.Ser=15]="Ser",e[e.Thr=16]="Thr",e[e.Trp=17]="Trp",e[e.Tyr=18]="Tyr",e[e.Val=19]="Val"})(ft||(ft={}));var E;(function(e){e.DNA="DNA",e.RNA="RNA",e.Protein="Protein",e.Unknown="Unknown"})(E||(E={}));function Wt(e){switch(!0){case e.residueName in x:return E.DNA;case e.residueName in A:return E.RNA;default:return E.Protein}}function mt(e){return`${e.residueName}${e.residueSequenceNumber}:${e.name}`}const h=nt.exports.jsx,w=nt.exports.jsxs,qt=nt.exports.Fragment,it={polymers:[],pdb:void 0,isLoading:!1,simpleStuffy:"",hashedNucleicAcidResidues:{},viz:{chain1:null,chain2:null},currentPDBId:"",error:"",selectedResidueHash:void 0,getResidue:function(e,t){if(this.polymers.length===0)return null;const n=this.polymers.filter(r=>r.chainIdentifier===e);if(n.length>0){const r=n[0].residues.filter(s=>s.hash===t);if(r.length>0)return r[0]}return null}},Y=G.exports.createContext([it,()=>{}]),Rt=(e,{type:t,payload:n})=>{switch(t){case"resetState":return et({},it);default:if(t in e)e[t]=n;else throw new Error(`${t} not found in state`)}return et({},e)},Ut=({children:e})=>{const[t,n]=G.exports.useReducer(Rt,it);return h(Y.Provider,{value:[t,n],children:e})};function yt(e){return e.residues.forEach((t,n)=>{const r=new Z(0,0,0);t.atoms.forEach(s=>{r.x+=s.coords.x,r.y+=s.coords.y,r.z+=s.coords.z}),r.x=r.x/t.atoms.length,r.y=r.y/t.atoms.length,r.z=r.z/t.atoms.length,e.residues[n].center=r}),e}var ot;(function(e){e[e.Threshold=0]="Threshold",e[e.HBond=1]="HBond"})(ot||(ot={}));const Kt=1.42,pt=e=>{if([E.DNA,E.RNA].indexOf(e.kind)!=-1){let t=["C2","C4","C6"];e.residues.forEach(n=>{let r=[];if(n.findAtomsByNames(t).forEach((a,i)=>{r[i]=a.coords}),r.length===3){const a=c.fromArray(r[0].toArray()),i=c.fromArray(r[1].toArray()),o=c.fromArray(r[2].toArray()),y=i.subtract(a).cross(o.subtract(a)).normalize(),p=a.add(i).add(o).divide(3);n.v=y,n.o=p}})}return e};function xt(e,t){const n=[[x.DA,x.DT],[x.DA,A.U],[x.DT,A.A],[x.DC,x.DG],[x.DC,A.G],[x.DG,x.DC],[x.DG,A.C],[A.C,A.G],[A.A,A.U],[x.CM,x.DG],[x.CM,A.G]];for(let r=0;r<n.length;r++)if(e.name===n[r][0]&&t.name===n[r][1]||e.name===n[r][1]&&t.name===n[r][0])return!0;return!1}const F=e=>`${e.polymerChainIdentifier}:${e.name}${e.sequenceNumber}`;class _t{constructor(t){D(this,"nucleicAcids",[]);D(this,"proteins",[]);D(this,"hasValidDNA",!1);D(this,"hasValidRNA",!1);D(this,"residues",new Map);D(this,"visualization",{chain1:null,chain2:null});this.polymers=t,this.prepareObjects()}generateWatsonCrickPairs(t,n){let r=this.calculateWatsonCrickPairs(t,n),s=this.calculateWatsonCrickPairs(n,t);s.reverse();let a=r;return s.forEach(i=>{if(i.length===1)a.push(i);else if(i.length===2){let o=!1;for(let y=0;y<r.length;y++){let p=r[y];if(p.length===2&&p[0].hash===i[1].hash&&p[1].hash===i[0].hash){o=!0;break}}o||console.log(`watsonCrickPairs: matching pair was not found ${i[1].polymerChainIdentifier}:${i[1].sequenceNumber}${i[1].name}---${i[0].polymerChainIdentifier}:${i[0].sequenceNumber}${i[0].name}`,i)}}),a}watsonCrickPairs(){if(this.nucleicAcids.length<=0)throw Error("Nucleic acids are not initialized");let t=[];for(let n=0;n<this.nucleicAcids.length;n++){for(let s=n+1;s<this.nucleicAcids.length;s++){const a=this.generateWatsonCrickPairs(this.nucleicAcids[n],this.nucleicAcids[s]);t.push(...a)}const r=this.generateWatsonCrickPairs(this.nucleicAcids[n],this.nucleicAcids[n]);r.length>0&&(console.log("SIMILAR PAIRS",r),t.push(...r))}return t}calculateWatsonCrickPairs(t,n){let r=[];return t.residues.forEach(s=>{let a=1/0,i;if(n.residues.forEach(o=>{let y=1/0,p=[1/0],C=[1/0];const f=s.findAtomsByNames(["C2","C4","C6"]);f.length==3&&(p=[Math.abs(f[0].coords.toVec().subtract(o.o).dot(o.v)),Math.abs(f[1].coords.toVec().subtract(o.o).dot(o.v)),Math.abs(f[2].coords.toVec().subtract(o.o).dot(o.v))]);const I=o.findAtomsByNames(["C2","C4","C6"]);I.length==3&&(C=[Math.abs(I[0].coords.toVec().subtract(s.o).dot(s.v)),Math.abs(I[1].coords.toVec().subtract(s.o).dot(s.v)),Math.abs(I[2].coords.toVec().subtract(s.o).dot(s.v))]),y=Math.max(...C,...p),y<a&&s.hash!==o.hash&&(a=y,i=o)}),i!==void 0&&a<=Kt+Math.random()&&xt(i,s)&&s.center.toVec().distanceTo(i.center.toVec())<15){r.push([s,i]);const o=i;console.log("Smallest distance: ",`${t.kind}-${s.polymerChainIdentifier}:${s.sequenceNumber}${s.name}`,`${n.kind}-${o.polymerChainIdentifier}:${o.sequenceNumber}${o.name}`,a,xt(i,s))}else r.push([s]),console.log(`No pair for: ${t.kind} ${s.polymerChainIdentifier}:${s.sequenceNumber}${s.name}, smallest distance: ${a}`,i)}),r}prepareObjects(){this.nucleicAcids=this.findNucleicAcids(),this.proteins=this.findProteins(),this.nucleicAcids.forEach(t=>{yt(t),this.populateResiduesMap(t)}),this.proteins.forEach(t=>{yt(t),this.populateResiduesMap(t)})}findProteins(){return this.polymers.filter(t=>[E.Protein].indexOf(t.kind)!==-1)}findNucleicAcids(){return this.polymers.filter(t=>[E.DNA,E.RNA].indexOf(t.kind)!==-1)}populateResiduesMap(t){t.residues.forEach(n=>this.residues.set(n.hash,n))}findResidueByHash(t){return this.residues.get(t)}simpleInteractions(){const t=4,n=10;this.nucleicAcids.forEach(r=>{r.residues.forEach(s=>{this.proteins.forEach(a=>{a.residues.forEach(i=>{let o=i.findAtomsByNames(["CA"]);if(o.length>0){const y=o[0],p=s.center.toVec().distanceTo(y.coords.toVec());p<=n&&(console.log(`Possible interaction between: ${F(i)} and ${F(s)} (${p})`),s.atoms.forEach(C=>{i.atoms.forEach(f=>{const I=C.coords.toVec().distanceTo(f.coords.toVec());if(I<=t){console.log(`	Interaction between: ${mt(f)} and ${mt(C)} (${I})`);const P={polymerKind:E.Protein,type:ot.Threshold,polymerChainIdentifier:i.polymerChainIdentifier,residueHash:i.hash,atom:f};s.interactions.push(P)}})}))}})})})})}}var U;(function(e){e.Residue="residue",e.InteractionsNumber="interactions_number",e.InteractionResidue="interaction_residue"})(U||(U={}));var W;(function(e){e.Pair="pair",e.Backbone="backbone",e.Interaction="interaction"})(W||(W={}));const J={size:10,y:4},Vt=100;function Zt({nodes:e,links:t,svgRef:n,dispatch:r},s){let{nodeId:a=l=>l.id,nodeGroups:i,nodeTitle:o,nodeFill:y=l=>l.color!==void 0?l.color:"currentColor",nodeStroke:p="#fff",nodeStrokeWidth:C=1.5,nodeStrokeOpacity:f=1,nodeRadius:I=10,linkStroke:P=l=>l.color!==void 0?l.color:"#444",linkStrokeOpacity:N=.6,linkStrokeWidth:d=1.5,linkStrokeLinecap:O="round",width:g=640,height:b=400,invalidation:u}=s;const S=e,k=t,m=dt(e,a).map(It);o===void 0&&(o=(l,L)=>m[L]);const z=typeof d!="function"?null:dt(t,d);e=S,t=k;const q=Pt(),T=Ot(t).id(({index:l})=>m[l]).distance((l,L)=>{switch(k[L].linkType){case W.Backbone:return 4;case W.Interaction:return 10;default:return 30}}).strength((l,L)=>{switch(k[L].linkType){case W.Backbone:return 1.8;case W.Interaction:return 1;default:return 1.2}}),v=St(e).force("link",T).force("nodes",q).on("tick",zt),j=rt(n).attr("width",g).attr("height",b).attr("viewBox",[-g/2,-b/2,g,b]).attr("style","max-width: 100%; height: auto; height: intrinsic;");j.html("");const $=j.append("g"),_=$.append("g").attr("stroke-opacity",N).attr("stroke-width",typeof d!="function"?d:null).attr("stroke-linecap",O).selectAll("line").data(t).join("line").attr("stroke-dasharray",l=>l.linkType==="pair"?"4":null).attr("stroke",P),M=$.append("g").selectAll("g").data(e).enter().append("g").call(Dt(v)),H=M.append("circle").attr("stroke",p).attr("stroke-opacity",f).attr("stroke-width",C).attr("fill",y).style("cursor","pointer").attr("r",I);let V=new Date;M.on("click",function(l,L){L.type&&[U.InteractionsNumber,U.Residue].indexOf(L.type)!==-1&&(r({type:"selectedResidueHash",payload:L.hash}),console.log("Clicked interaction bubble"))}).on("mouseover",function(l,L){rt(this).select("circle").attr("r",lt(I*2)),new Date().getTime()-V.getTime()>Vt&&(V=new Date)}).on("mouseout",function(l,L){rt(this).select("circle").attr("r",lt(I))});const Ct=M.append("text").text(l=>l.name).attr("text-anchor","middle").attr("font-size",J.size).attr("y",J.y).attr("class","svg-graph-text");z&&_.attr("stroke-width",l=>z[l.index]),u!=null&&u.then(()=>v.stop());function It(l){return l!==null&&typeof l=="object"?l.valueOf():l}function zt(){_.attr("x1",l=>l.source.x).attr("y1",l=>l.source.y).attr("x2",l=>l.target.x).attr("y2",l=>l.target.y),M.attr("transform",l=>`translate(${l.x}, ${l.y})`)}function Dt(l){function L(B){B.active||l.alphaTarget(.3).restart(),B.subject.fx=B.subject.x,B.subject.fy=B.subject.y}function kt(B){B.subject.fx=B.x,B.subject.fy=B.y}function Mt(B){B.active||l.alphaTarget(0),B.subject.fx=null,B.subject.fy=null}return Bt().on("start",L).on("drag",kt).on("end",Mt)}const lt=l=>R?l/R:l;let X,R;const ct=$t().on("zoom",l=>{requestAnimationFrame(()=>{$.attr("transform",X=l.transform),X&&(R=Math.sqrt(X.k),$.style("stroke-width",3/R),H.attr("r",I/R).attr("stroke-width",C/R),Ct.attr("font-size",J.size/R).attr("y",J.y/R))})});return j.call(ct).call(ct.transform,Lt),Object.assign(j.node(),{scales:{color:null}})}const gt={[x.DA]:"#fcb331",[x.DT]:"#5670fb",[x.DG]:"#f63c37",[x.DC]:"#03c907",[x.CM]:"#03c907",[A.A]:"#acb331",[A.U]:"#a670fb",[A.G]:"#a63c37",[A.C]:"#a3c907",[A.I]:"#a3c907",interaction:"#333"},Q="red",K="blue",wt={[x.DA]:Q,[x.DT]:Q,[x.DG]:K,[x.DC]:K,[x.CM]:K,[A.A]:Q,[A.U]:Q,[A.G]:K,[A.C]:K,[A.I]:K,interaction:"#718355"},Yt="#494949";function Jt(){const[e,t]=G.exports.useContext(Y),n=e.polymers;let r=st.createRef(),s=st.createRef(),a=G.exports.useRef(null);const i=G.exports.useMemo(()=>{if(n.length>0){const p=new _t(n);return window.iFinder=p,p}},[n]);function o(){if(!r||n.length<=0||!i)return;console.time("Nucleic_acid_VIZ");let p;try{p=i.watsonCrickPairs()}catch(d){console.log(d),t({type:"error",payload:d.toString()});return}i.simpleInteractions();let C=[],f=[];const I=d=>{const O=Object.values(x);d.residues.forEach((g,b)=>{C.push({hash:g.hash,name:g.name.toString().slice(-1),id:F(g),color:gt[g.name],group:O.indexOf(g.name)+1,type:U.Residue});let u=d.residues;if(b>0&&b<u.length&&f.push({source:F(u[b-1]),target:F(g),value:1,color:Yt,linkType:W.Backbone}),g.interactions.length>0){const S=F(g)+"-interactions";C.push({hash:g.hash,name:g.interactions.length.toString(),id:S,color:gt.interaction,group:5,type:U.InteractionsNumber}),f.push({source:S,target:F(g),value:1,color:wt.interaction,linkType:W.Interaction})}})};i.nucleicAcids.forEach(d=>I(d)),p.forEach(d=>{const O=d[0];if(d.length===2){const g=d[1];f.push({source:F(g),target:F(O),value:1,color:wt[O.name],linkType:W.Pair})}}),console.log("Vizualization data:",C,f);let[P,N]=[a.current.offsetWidth,a.current.offsetHeight];Zt({nodes:C,links:f,svgRef:r.current,dispatch:t},{width:P,height:N}),console.timeEnd("Nucleic_acid_VIZ")}G.exports.useEffect(o,[n]);const y=G.exports.useMemo(()=>{if(i&&e.selectedResidueHash)return i.findResidueByHash(e.selectedResidueHash)},[e.selectedResidueHash]);return w(qt,{children:[h("div",{children:e.simpleStuffy}),w("div",{className:"p-5 flex items-center flex-col h-full",ref:a,children:[w("div",{className:"min-w-full h-full relative",children:[h("svg",{ref:r}),y&&w("div",{className:"\r text-xs p-4\r absolute bottom-[10px] right-[10px]\r w-[50%] h-[100px] bg-indigo-400\r overflow-auto text-white rounded-lg\r ",children:[w("div",{children:["Chain: ",y.polymerChainIdentifier]}),w("div",{children:["Residue: ",y.name,":",y.sequenceNumber]}),w("div",{children:["Interactions:"," ",y.interactions.map(p=>h("div",{children:JSON.stringify(p)}))]})]})]}),h("div",{ref:s,style:{position:"absolute",opacity:0,background:"#fff"}})]})]})}const Nt=new Set,at=()=>{const e=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16));return Nt.has(e)?at():(Nt.add(e),e)};class bt{constructor(t){D(this,"file");t!==void 0&&(this.file=t)}async readData(){if(this.file==null)throw Error("file not provided");let t=await this.file.text();return this.format(t)}format(t){return{raw:this.formatText(t),polymers:this.formatPolymers(t)}}formatText(t){return t.split(`
`).map((n,r)=>r.toString()+". "+n).join(`
`)}formatPolymers(t){let n=[];const r=()=>({chainIdentifier:"",residues:[],kind:E.Unknown}),s=()=>new Ft,a=()=>{o.hash=at(),i.residues.push(o)};let i=r(),o=s();const y=b=>{let u={[E.DNA]:0,[E.RNA]:0,[E.Protein]:0};return b===void 0?u:[u,Object.keys(b).reduce((S,k)=>b[S]>b[k]?S:k)]};let p=y(),C=[],f={chains:[],rotations:[],translations:[c.infinity()]},I=!1;const P=()=>{f={chains:[],rotations:[],translations:[c.infinity()]}};let N=!1,d=0,O=0;const g=t.split(`
`);for(let b=0;b<g.length;b++){const u=g[b];if(!(N&&O>1)){if(u.startsWith("NUMMDL")&&(N=!0,d=parseInt(u.slice(10,14).trim()),console.log("NUMBER OF MODELS:",d)),u.startsWith("MODEL")&&(O=parseInt(u.slice(11,14).trim())),u.startsWith("ATOM")||u.startsWith("HETATM")){let S=parseFloat(u.slice(30,38).trim()),k=parseFloat(u.slice(38,46).trim()),m=parseFloat(u.slice(46,54).trim()),z=u.slice(12,16).trim(),q=u.slice(17,20).trim(),T=u.slice(76,78).trim(),v=parseInt(u.slice(22,26).trim()),j=u.slice(21,22);i.chainIdentifier=j;const $={coords:new Z(S,k,m),name:z,element:T,residueName:q,residueSequenceNumber:v};p[Wt($)]++,o.sequenceNumber===-1&&(o.name=$.residueName,o.sequenceNumber=v,o.polymerChainIdentifier=j),v!==o.sequenceNumber&&(a(),o=s(),o.name=$.residueName,o.sequenceNumber=v,o.polymerChainIdentifier=j),o.atoms.push($)}if(u.startsWith("TER")||b===g.length-1){a();let[S,k]=y(p);p=S,i.kind=k,i=pt(i),n.push(i),i=r(),o=s()}if(u.startsWith("REMARK 350")){if(I=!0,["REMARK 350 APPLY THE FOLLOWING TO CHAINS: ","REMARK 350                    AND CHAINS:"].forEach((k,m)=>{if(u.startsWith(k)){let z=u.trim().slice(k.length-1,u.length).toString().replaceAll(" ","").split(",");m===0&&(P(),f.chains.length>0&&C.push(f)),z.length>0&&f.chains.push(...z)}}),u.startsWith("REMARK 350   BIOMT")){let m=u.replace("REMARK 350   BIOMT","").match(new RegExp(/(\d{1})\s*(\d{1})\s*([+-]?[0-9]*[.]?[0-9]+)\s*([+-]?[0-9]*[.]?[0-9]+)\s*([+-]?[0-9]*[.]?[0-9]+)\s*([+-]?[0-9]*[.]?[0-9]+)/));if(m!=null&&m.length===6+1){m=m.slice(1);let z=parseInt(m[1])-1,q=parseInt(m[0])-1,T=[parseFloat(m[2]),parseFloat(m[3]),parseFloat(m[4])],v=parseFloat(m[5]);typeof f.translations[z]=="undefined"&&(f.translations[z]=c.infinity()),f.translations[z].setIndex(q,v),Array.isArray(f.rotations[z])||(f.rotations[z]=[]),f.rotations[z][q]=T}}}else I&&(C.push(f),P()),I=!1}}return C.forEach(b=>{const u=n.filter(m=>b.chains.indexOf(m.chainIdentifier)!==-1),S=b.rotations.slice(1),k=b.translations.slice(1);S.forEach((m,z)=>{u.forEach(q=>{let T=Gt(q,{includeNonEnumerable:!0});T.chainIdentifier=T.chainIdentifier+(z+1).toString(),T.generatedFromTransform=!0,T.residues.forEach((v,j)=>{v.polymerChainIdentifier=T.chainIdentifier,v.atoms.forEach(($,_)=>{let M=$.coords.toVec(),H=c.infinity();console.log("Coorinates before:",M),H.x=M.x*m[0][0]+M.y*m[0][1]+M.z*m[0][2],H.y=M.x*m[1][0]+M.y*m[1][1]+M.z*m[1][2],H.z=M.x*m[2][0]+M.y*m[2][1]+M.z*m[2][2];const V=k[z];H=H.add(V),console.log("Coords after:",H),console.log("Distance between atoms: ",H.distanceTo(M)),$.coords=H.toCoord(),v.atoms[_]=$}),v.hash=at(),T.residues[j]=v}),T=pt(T),n.push(T)})})}),console.log("Transformations:",C),console.log("Result after translation",n),n}}const Qt=async e=>await(await fetch(`https://files.rcsb.org/download/${e}.pdb`)).text();function Xt(){var P;const[e,t]=G.exports.useContext(Y),n=()=>{t({type:"isLoading",payload:!0})},r=()=>{t({type:"isLoading",payload:!1})},s=N=>{t({type:"pdb",payload:N})},a=N=>{t({type:"currentPDBId",payload:N})},i=N=>{t({type:"polymers",payload:N})},o=()=>{t({type:"resetState",payload:null})},y=async N=>{o(),n();const d=new bt().format(await Qt(N));s(d),i(d.polymers),a(N),r()};G.exports.useEffect(()=>{const d=new URLSearchParams(window.location.search).get("id");console.log("ID",d),d!==null&&y(d)},[]);const p=async N=>{var O;let d=(O=N.target.files)==null?void 0:O.item(0);if(d!==null){o(),n(),console.time("TIME_TO_PARSE_EVERYTHING"),console.time("TIME_TO_PARSE_PDB");const g=await new bt(d).readData();console.timeEnd("TIME_TO_PARSE_PDB"),s(g),i(g.polymers),console.timeEnd("TIME_TO_PARSE_EVERYTHING"),setTimeout(r,2e3)}};let C;e.polymers.length>0&&(C=w("div",{className:"mt-5",children:[h("div",{className:"mb-1",children:"Provided input file"}),h("textarea",{className:"text-sm w-full border h-96 border-blue-100",value:(P=e.pdb)==null?void 0:P.raw,readOnly:!0})]}));const f=G.exports.useRef(null),I=()=>{var d;const N=(d=f.current)==null?void 0:d.value;N&&y(N)};return w("div",{className:"p-5 max-h-screen overflow-auto break-words",children:[!e.isLoading&&w("div",{children:[e.error.length>0&&h("div",{className:"mb-4",children:w("div",{className:"text-red-700 font-bold text-lg",children:["Something went wrong: ",e.error]})}),e.pdb===void 0&&h("div",{className:"text-sm text-gray-600 mb-4 bg-red-200 p-2",children:"Choose a PDB file which contains DNA/RNA with Proteins"}),w("div",{children:[e.currentPDBId.length>0&&w("div",{className:"mb-4",children:["Currently selected PDB ID:",h("b",{children:e.currentPDBId.toUpperCase()})]}),w("div",{className:"mb-4",children:[w("div",{className:"text-normal font-bold text-gray-600 mb-2",children:["Enter PDB file ID:",w("div",{className:"text-xs font-normal",children:["PDB file should contain ",h("b",{children:"DNA/RNA"})," structures"]})]}),w("div",{className:"flex flex-row max-w-full",children:[h("input",{onKeyPress:N=>{N.key==="Enter"&&I()},ref:f,placeholder:"1ZS4",className:"border-r-0 outline-none ring-indigo-200 focus:ring-2 transition-all block py-1 px-2 outline-0 border border-indigo-300 rounded rounded-tr-none rounded-br-none"}),h("button",{onClick:I,className:"bg-indigo-400 border-l-0 text-white font-bold text-sm ring-indigo-200 focus:ring-2 hover:bg-indigo-600 transition-all w-[100px]  block rounded rounded-tl-none rounded-bl-none border border-indigo-300",children:"GO"})]})]}),w("div",{className:"text-normal font-bold text-gray-600 mb-2",children:["Or choose a PDB file to display:",w("div",{className:"text-xs font-normal",children:["PDB file should contain ",h("b",{children:"DNA/RNA"})," structures"]})]}),h("input",{type:"file",onChange:p,className:"max-w-full"})]})]}),C,e.pdb&&w("div",{children:["Polymers from input:",e.polymers.map(({residues:N,chainIdentifier:d,kind:O},g)=>w("div",{className:"ml-2",children:["Chain:"," ",w("b",{children:[d," (",O,")"]}),h("div",{className:"ml-2",children:N.map((b,u)=>w("span",{children:[b.name," \xA0"]},u))})]},g))]})]})}const te=()=>w("div",{className:"flex flex-col items-center gap-1",children:[h("div",{className:"text-white font-bold",children:"Loading"}),w("div",{className:"lds-roller",children:[h("div",{}),h("div",{}),h("div",{}),h("div",{}),h("div",{}),h("div",{}),h("div",{}),h("div",{})]})]});function ee(){const e=G.exports.useContext(Y)[0];return w("div",{className:"w-full flex flex-row",children:[e.isLoading===!0&&h("div",{className:"fixed w-screen min-h-screen top-0 left-0 flex items-center justify-center z-50  h-full",style:{backgroundColor:"rgba(0,0,0,0.75)"},children:h(te,{})}),h("div",{className:"z-10 w-9/12 bg-indigo-200 min-h-full h-screen",children:h(Jt,{})}),h("div",{className:"z-10 w-3/12",children:h(Xt,{})})]})}function ne({children:e}){return h(Ut,{children:e})}const re="modulepreload",At={},se="/",ie=function(t,n){return!n||n.length===0?t():Promise.all(n.map(r=>{if(r=`${se}${r}`,r in At)return;At[r]=!0;const s=r.endsWith(".css"),a=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${a}`))return;const i=document.createElement("link");if(i.rel=s?"stylesheet":re,s||(i.as="script",i.crossOrigin=""),i.href=r,document.head.appendChild(i),s)return new Promise((o,y)=>{i.addEventListener("load",o),i.addEventListener("error",y)})})).then(()=>t())},oe=e=>{e&&e instanceof Function&&ie(()=>import("./web-vitals.d62816c8.js"),[]).then(({getCLS:t,getFID:n,getFCP:r,getLCP:s,getTTFB:a})=>{t(e),n(e),r(e),s(e),a(e)})};jt.render(h(st.StrictMode,{children:h(ne,{children:h(ee,{})})}),document.getElementById("root"));oe();
