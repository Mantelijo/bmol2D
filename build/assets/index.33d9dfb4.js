var Et=Object.defineProperty,vt=Object.defineProperties;var St=Object.getOwnPropertyDescriptors;var ct=Object.getOwnPropertySymbols;var Ot=Object.prototype.hasOwnProperty,Bt=Object.prototype.propertyIsEnumerable;var tt=(e,t,n)=>t in e?Et(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,V=(e,t)=>{for(var n in t||(t={}))Ot.call(t,n)&&tt(e,n,t[n]);if(ct)for(var n of ct(t))Bt.call(t,n)&&tt(e,n,t[n]);return e},ht=(e,t)=>vt(e,St(t));var T=(e,t,n)=>(tt(e,typeof t!="symbol"?t+"":t,n),n);import{j as et,r as F,m as dt,l as Lt,s as $t,a as nt,d as Pt,z as Gt,i as jt,b as Ft,R as rt,c as Wt,e as qt}from"./vendor.81ab7bc9.js";const Ht=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}};Ht();class c{constructor(t,n,r){this.x=t,this.y=n,this.z=r,this.x=t||0,this.y=n||0,this.z=r||0}negative(){return new c(-this.x,-this.y,-this.z)}add(t){return t instanceof c?new c(this.x+t.x,this.y+t.y,this.z+t.z):new c(this.x+t,this.y+t,this.z+t)}subtract(t){return t instanceof c?new c(this.x-t.x,this.y-t.y,this.z-t.z):new c(this.x-t,this.y-t,this.z-t)}multiply(t){return t instanceof c?new c(this.x*t.x,this.y*t.y,this.z*t.z):new c(this.x*t,this.y*t,this.z*t)}divide(t){return t instanceof c?new c(this.x/t.x,this.y/t.y,this.z/t.z):new c(this.x/t,this.y/t,this.z/t)}equals(t){return this.x==t.x&&this.y==t.y&&this.z==t.z}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return new c(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}length(){return Math.sqrt(this.dot(this))}magnitude(){return this.length()}unit(){return this.divide(this.length())}min(){return Math.min(Math.min(this.x,this.y),this.z)}max(){return Math.max(Math.max(this.x,this.y),this.z)}toAngles(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length())}}angleTo(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}toArray(t){return[this.x,this.y,this.z].slice(0,t||3)}toCoord(){return new Z(this.x,this.y,this.z)}clone(){return new c(this.x,this.y,this.z)}init(t,n,r){return this.x=t,this.y=n,this.z=r,this}normalize(){return this.unit()}setIndex(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break}}distanceTo(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)+Math.pow(this.z-t.z,2))}static negative(t,n,r){return n.x=-t.x,n.y=-t.y,n.z=-t.z,n}static add(t,n,r){return n instanceof c?(r.x=t.x+n.x,r.y=t.y+n.y,r.z=t.z+n.z):(r.x=t.x+n,r.y=t.y+n,r.z=t.z+n),r}static subtract(t,n,r){return n instanceof c?(r.x=t.x-n.x,r.y=t.y-n.y,r.z=t.z-n.z):(r.x=t.x-n,r.y=t.y-n,r.z=t.z-n),r}static multiply(t,n,r){return n instanceof c?(r.x=t.x*n.x,r.y=t.y*n.y,r.z=t.z*n.z):(r.x=t.x*n,r.y=t.y*n,r.z=t.z*n),r}static divide(t,n,r){return n instanceof c?(r.x=t.x/n.x,r.y=t.y/n.y,r.z=t.z/n.z):(r.x=t.x/n,r.y=t.y/n,r.z=t.z/n),r}static cross(t,n,r){return r.x=t.y*n.z-t.z*n.y,r.y=t.z*n.x-t.x*n.z,r.z=t.x*n.y-t.y*n.x,r}static unit(t,n,r){var s=t.length();return n.x=t.x/s,n.y=t.y/s,n.z=t.z/s,n}static fromAngles(t,n){return new c(Math.cos(t)*Math.cos(n),Math.sin(n),Math.sin(t)*Math.cos(n))}static randomDirection(){return c.fromAngles(Math.random()*Math.PI*2,Math.asin(Math.random()*2-1))}static min(t,n,r){return new c(Math.min(t.x,n.x),Math.min(t.y,n.y),Math.min(t.z,n.z))}static max(t,n,r){return new c(Math.max(t.x,n.x),Math.max(t.y,n.y),Math.max(t.z,n.z))}static lerp(t,n,r){return n.subtract(t).multiply(r).add(t)}static fromArray(t){return new c(t[0],t[1],t[2])}static angleBetween(t,n,r){return t.angleTo(n)}static infinity(){return new c(1/0,1/0,1/0)}}class Z{constructor(t,n,r){this.x=t,this.y=n,this.z=r}toVec(){return c.fromArray(this.toArray())}toArray(){return[this.x,this.y,this.z]}}var ut;(function(e){e.A="\u03B1",e.B="\u03B2",e.G="\u03B3",e.D="\u03B4",e.E="\u03B5",e.Z="\u03B6",e.H="\u03B7"})(ut||(ut={}));class Rt{constructor(){T(this,"center");T(this,"interactions");T(this,"atoms");T(this,"v");T(this,"o");T(this,"hash");T(this,"name");T(this,"sequenceNumber");T(this,"polymerChainIdentifier");this.atoms=[],this.name="",this.sequenceNumber=-1,this.center=new Z(-1,-1,-1),this.hash="",this.interactions=[],this.polymerChainIdentifier="",this.v=c.infinity(),this.o=c.infinity()}findAtomsByNames(t){let n=[];return this.atoms.forEach(r=>{t.indexOf(r.name)!==-1&&n.push(r)}),n.sort((r,s)=>t.indexOf(r.name)-t.indexOf(s.name)),n}}var m;(function(e){e.DA="DA",e.DG="DG",e.DC="DC",e.DT="DT",e.CM="5CM"})(m||(m={}));var C;(function(e){e.A="A",e.C="C",e.G="G",e.I="I",e.U="U"})(C||(C={}));var ft;(function(e){e[e.Ala=0]="Ala",e[e.Arg=1]="Arg",e[e.Asn=2]="Asn",e[e.Asp=3]="Asp",e[e.Cys=4]="Cys",e[e.Glu=5]="Glu",e[e.Gln=6]="Gln",e[e.Gly=7]="Gly",e[e.His=8]="His",e[e.Ile=9]="Ile",e[e.Leu=10]="Leu",e[e.Lys=11]="Lys",e[e.Met=12]="Met",e[e.Phe=13]="Phe",e[e.Pro=14]="Pro",e[e.Ser=15]="Ser",e[e.Thr=16]="Thr",e[e.Trp=17]="Trp",e[e.Tyr=18]="Tyr",e[e.Val=19]="Val"})(ft||(ft={}));var O;(function(e){e.DNA="DNA",e.RNA="RNA",e.Protein="Protein",e.Unknown="Unknown"})(O||(O={}));function Ut(e){switch(!0){case e.residueName in m:return O.DNA;case e.residueName in C:return O.RNA;default:return O.Protein}}function mt(e){return`${e.residueName}${e.residueSequenceNumber}:${e.name}`}const d=et.exports.jsx,y=et.exports.jsxs,Kt=et.exports.Fragment,st={polymers:[],pdb:void 0,isLoading:!1,simpleStuffy:"",hashedNucleicAcidResidues:{},viz:{chain1:null,chain2:null},currentPDBId:"",selectedResidue:void 0,error:""},Y=F.exports.createContext([st,()=>{}]),_t=(e,{type:t,payload:n})=>{switch(t){case"resetState":return V({},st);default:if(t in e)e[t]=n;else throw new Error(`${t} not found in state`)}return V({},e)},Vt=({children:e})=>{const[t,n]=F.exports.useReducer(_t,st);return d(Y.Provider,{value:[t,n],children:e})};function yt(e){return e.residues.forEach((t,n)=>{const r=new Z(0,0,0);t.atoms.forEach(s=>{r.x+=s.coords.x,r.y+=s.coords.y,r.z+=s.coords.z}),r.x=r.x/t.atoms.length,r.y=r.y/t.atoms.length,r.z=r.z/t.atoms.length,e.residues[n].center=r}),e}function pt(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2))}function Zt(e){const{sequenceNumber:t,hash:n,name:r,polymerChainIdentifier:s}=e;return{sequenceNumber:t,hash:n,name:r,polymerChainIdentifier:s}}const xt=5;var it;(function(e){e[e.Threshold=0]="Threshold",e[e.HBond=1]="HBond"})(it||(it={}));const Yt=1.42,gt=e=>{if([O.DNA,O.RNA].indexOf(e.kind)!=-1){let t=["C2","C4","C6"];e.residues.forEach(n=>{let r=[];if(n.findAtomsByNames(t).forEach((a,i)=>{r[i]=a.coords}),r.length===3){const a=c.fromArray(r[0].toArray()),i=c.fromArray(r[1].toArray()),o=c.fromArray(r[2].toArray()),p=i.subtract(a).cross(o.subtract(a)).normalize(),g=a.add(i).add(o).divide(3);n.v=p,n.o=g}})}return e};function At(e,t){const n=[[m.DA,m.DT],[m.DA,C.U],[m.DT,C.A],[m.DC,m.DG],[m.DC,C.G],[m.DG,m.DC],[m.DG,C.C],[C.C,C.G],[C.A,C.U],[m.CM,m.DG],[m.CM,C.G]];for(let r=0;r<n.length;r++)if(e.name===n[r][0]&&t.name===n[r][1]||e.name===n[r][1]&&t.name===n[r][0])return!0;return!1}const H=e=>`${e.polymerChainIdentifier}:${e.name}${e.sequenceNumber}`;class Jt{constructor(t){T(this,"nucleicAcids",[]);T(this,"proteins",[]);T(this,"hasValidDNA",!1);T(this,"hasValidRNA",!1);T(this,"visualization",{chain1:null,chain2:null});this.polymers=t,this.prepareObjects()}generateWatsonCrickPairs(t,n){let r=this.calculateWatsonCrickPairs(t,n),s=this.calculateWatsonCrickPairs(n,t);s.reverse();let a=r;return s.forEach(i=>{if(i.length===1)a.push(i);else if(i.length===2){let o=!1;for(let p=0;p<r.length;p++){let g=r[p];if(g.length===2&&g[0].hash===i[1].hash&&g[1].hash===i[0].hash){o=!0;break}}o||console.log(`watsonCrickPairs: matching pair was not found ${i[1].polymerChainIdentifier}:${i[1].sequenceNumber}${i[1].name}---${i[0].polymerChainIdentifier}:${i[0].sequenceNumber}${i[0].name}`,i)}}),a}watsonCrickPairs(){if(this.nucleicAcids.length<=0)throw Error("Nucleic acids are not initialized");let t=[];for(let n=0;n<this.nucleicAcids.length;n++){for(let s=n+1;s<this.nucleicAcids.length;s++){const a=this.generateWatsonCrickPairs(this.nucleicAcids[n],this.nucleicAcids[s]);t.push(...a)}const r=this.generateWatsonCrickPairs(this.nucleicAcids[n],this.nucleicAcids[n]);r.length>0&&(console.log("SIMILAR PAIRS",r),t.push(...r))}return t}calculateWatsonCrickPairs(t,n){let r=[];return t.residues.forEach(s=>{let a=1/0,i;if(n.residues.forEach(o=>{let p=1/0,g=[1/0],A=[1/0];const x=s.findAtomsByNames(["C2","C4","C6"]);x.length==3&&(g=[Math.abs(x[0].coords.toVec().subtract(o.o).dot(o.v)),Math.abs(x[1].coords.toVec().subtract(o.o).dot(o.v)),Math.abs(x[2].coords.toVec().subtract(o.o).dot(o.v))]);const z=o.findAtomsByNames(["C2","C4","C6"]);z.length==3&&(A=[Math.abs(z[0].coords.toVec().subtract(s.o).dot(s.v)),Math.abs(z[1].coords.toVec().subtract(s.o).dot(s.v)),Math.abs(z[2].coords.toVec().subtract(s.o).dot(s.v))]),p=Math.max(...A,...g),p<a&&s.hash!==o.hash&&(a=p,i=o)}),i!==void 0&&a<=Yt+Math.random()&&At(i,s)&&s.center.toVec().distanceTo(i.center.toVec())<15){r.push([s,i]);const o=i;console.log("Smallest distance: ",`${t.kind}-${s.polymerChainIdentifier}:${s.sequenceNumber}${s.name}`,`${n.kind}-${o.polymerChainIdentifier}:${o.sequenceNumber}${o.name}`,a,At(i,s))}else r.push([s]),console.log(`No pair for: ${t.kind} ${s.polymerChainIdentifier}:${s.sequenceNumber}${s.name}, smallest distance: ${a}`,i)}),r}prepareObjects(){this.nucleicAcids=this.findNucleicAcids(),this.proteins=this.findProteins(),this.nucleicAcids.forEach(t=>yt(t)),this.proteins.forEach(t=>yt(t))}findProteins(){return this.polymers.filter(t=>[O.Protein].indexOf(t.kind)!==-1)}findNucleicAcids(){return this.polymers.filter(t=>[O.DNA,O.RNA].indexOf(t.kind)!==-1)}thresholdInteractions(){this.nucleicAcids.forEach((t,n)=>{t.residues.forEach((r,s)=>{this.proteins.forEach(a=>{a.residues.forEach(i=>{pt(r.center,i.center)<=xt*2&&r.atoms.forEach(p=>{i.atoms.forEach(g=>{const A=pt(p.coords,g.coords);A<=xt&&this.nucleicAcids[n].residues[s].interactions.push({residue:Zt(i),type:it.Threshold,polymerKind:a.kind,meta:{distance:A}})})})})})})})}simpleInteractions(){const t=4,n=10;this.nucleicAcids.forEach(r=>{r.residues.forEach(s=>{this.proteins.forEach(a=>{a.residues.forEach(i=>{let o=i.findAtomsByNames(["CA"]);if(o.length>0){const p=o[0],g=s.center.toVec().distanceTo(p.coords.toVec());g<=n&&(console.log(`Possible interaction between: ${H(i)} and ${H(s)} (${g})`),s.atoms.forEach(A=>{i.atoms.forEach(x=>{const z=A.coords.toVec().distanceTo(x.coords.toVec());z<=t&&console.log(`	Interaction between: ${mt(x)} and ${mt(A)} (${z})`)})}))}})})})})}}var K;(function(e){e.Pair="pair",e.Backbone="backbone"})(K||(K={}));const J={size:10,y:4},Qt=100;function Xt({nodes:e,links:t,svgRef:n,dispatch:r},s){let{nodeId:a=l=>l.id,nodeGroups:i,nodeTitle:o,nodeFill:p=l=>l.color!==void 0?l.color:"currentColor",nodeStroke:g="#fff",nodeStrokeWidth:A=1.5,nodeStrokeOpacity:x=1,nodeRadius:z=10,nodeStrength:P,linkStroke:h=l=>l.color!==void 0?l.color:"#444",linkStrokeOpacity:w=.6,linkStrokeWidth:N=1.5,linkStrokeLinecap:v="round",linkStrength:b=2,width:u=640,height:B=400,invalidation:M}=s;const f=e,I=t,j=dt(e,a).map(It);o===void 0&&(o=(l,G)=>j[G]);const D=typeof N!="function"?null:dt(t,N);e=f,t=I;const E=Ft(),W=Lt(t).id(({index:l})=>j[l]).distance((l,G)=>I[G].linkType===K.Backbone?5:70).strength((l,G)=>I[G].linkType===K.Backbone?5e3:1);P!==void 0&&E.strength(P),b!==void 0&&W.strength(b);const L=$t(e).force("link",W).force("charge",E).on("tick",Dt),R=nt(n).attr("width",u).attr("height",B).attr("viewBox",[-u/2,-B/2,u,B]).attr("style","max-width: 100%; height: auto; height: intrinsic;");R.html("");const k=R.append("g"),$=k.append("g").attr("stroke-opacity",w).attr("stroke-width",typeof N!="function"?N:null).attr("stroke-linecap",v).selectAll("line").data(t).join("line").attr("stroke-dasharray",l=>l.linkType==="pair"?"4":null).attr("stroke",h),U=k.append("g").selectAll("g").data(e).enter().append("g").call(kt(L)),zt=U.append("circle").attr("stroke",g).attr("stroke-opacity",x).attr("stroke-width",A).attr("fill",p).attr("r",z);let ot=new Date;U.on("mouseover",function(l,G){nt(this).select("circle").attr("r",at(z*2)),new Date().getTime()-ot.getTime()>Qt&&(r({type:"selectedResidue",payload:G}),ot=new Date)}).on("mouseout",function(l,G){nt(this).select("circle").attr("r",at(z)),r({type:"selectedResidue",payload:void 0})});const bt=U.append("text").text(l=>l.name).attr("text-anchor","middle").attr("font-size",J.size).attr("y",J.y).attr("class","svg-graph-text");D&&$.attr("stroke-width",l=>D[l.index]),M!=null&&M.then(()=>L.stop());function It(l){return l!==null&&typeof l=="object"?l.valueOf():l}function Dt(){$.attr("x1",l=>l.source.x).attr("y1",l=>l.source.y).attr("x2",l=>l.target.x).attr("y2",l=>l.target.y),U.attr("transform",l=>`translate(${l.x}, ${l.y})`)}function kt(l){function G(S){S.active||l.alphaTarget(.3).restart(),S.subject.fx=S.subject.x,S.subject.fy=S.subject.y}function Tt(S){S.subject.fx=S.x,S.subject.fy=S.y}function Mt(S){S.active||l.alphaTarget(0),S.subject.fx=null,S.subject.fy=null}return Pt().on("start",G).on("drag",Tt).on("end",Mt)}const at=l=>q?l/q:l;let X,q;const lt=Gt().on("zoom",l=>{k.attr("transform",X=l.transform),X&&(q=Math.sqrt(X.k),k.style("stroke-width",3/q),zt.attr("r",z/q).attr("stroke-width",A/q),bt.attr("font-size",J.size/q).attr("y",J.y/q))});return R.call(lt).call(lt.transform,jt),Object.assign(R.node(),{scales:{color:null}})}const te={[m.DA]:"#fcb331",[m.DT]:"#5670fb",[m.DG]:"#f63c37",[m.DC]:"#03c907",[m.CM]:"#03c907",[C.A]:"#acb331",[C.U]:"#a670fb",[C.G]:"#a63c37",[C.C]:"#a3c907",[C.I]:"#a3c907"},Q="red",_="blue",ee={[m.DA]:Q,[m.DT]:Q,[m.DG]:_,[m.DC]:_,[m.CM]:_,[C.A]:Q,[C.U]:Q,[C.G]:_,[C.C]:_,[C.I]:_},ne="#494949";function re(){const[e,t]=F.exports.useContext(Y),n=e.polymers;let r=rt.createRef(),s=rt.createRef(),a=F.exports.useRef(null);function i(){if(!r||n.length<=0)return;console.time("Nucleic_acid_VIZ");const o=new Jt(n);let p;try{p=o.watsonCrickPairs()}catch(h){console.log(h),t({type:"error",payload:h.toString()});return}let g=[],A=[];const x=h=>{const w=Object.values(m);h.residues.forEach((N,v)=>{g.push(ht(V({},N),{hash:N.hash,name:N.name.toString().slice(-1),id:H(N),color:te[N.name],group:w.indexOf(N.name)+1}));let b=h.residues;v>0&&v<b.length&&A.push({source:H(b[v-1]),target:H(N),value:1,color:ne,linkType:K.Backbone})})};o.nucleicAcids.forEach(h=>x(h)),p.forEach(h=>{const w=h[0];if(h.length===2){const N=h[1];A.push({source:H(N),target:H(w),value:1,color:ee[w.name],linkType:K.Pair})}}),o.simpleInteractions(),console.log("Vizualization data:",g,A);let[z,P]=[a.current.offsetWidth,a.current.offsetHeight];Xt({nodes:g,links:A,svgRef:r.current,dispatch:t},{width:z,height:P}),console.timeEnd("Nucleic_acid_VIZ")}return F.exports.useEffect(i,[n]),y(Kt,{children:[d("div",{children:e.simpleStuffy}),y("div",{className:"p-5 flex items-center flex-col h-full",ref:a,children:[y("div",{className:"min-w-full h-full relative",children:[d("svg",{ref:r}),e.selectedResidue&&y("div",{className:"\r text-xs p-4\r absolute bottom-[10px] right-[10px]\r w-[50%] h-[100px] bg-indigo-400\r overflow-auto text-white rounded-lg\r ",children:[y("div",{children:["Chain: ",e.selectedResidue.polymerChainIdentifier]}),y("div",{children:["Residue: ",e.selectedResidue.name,":",e.selectedResidue.sequenceNumber]}),y("div",{children:["Interactions:"," ",e.selectedResidue.interactions.map(o=>y("div",{children:[o.polymerKind," - ",o.residue]}))]})]})]}),d("div",{ref:s,style:{position:"absolute",opacity:0,background:"#fff"}})]})]})}function wt(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}class Nt{constructor(t){T(this,"file");t!==void 0&&(this.file=t)}async readData(){if(this.file==null)throw Error("file not provided");let t=await this.file.text();return this.format(t)}format(t){return{raw:this.formatText(t),polymers:this.formatPolymers(t)}}formatText(t){return t.split(`
`).map((n,r)=>r.toString()+". "+n).join(`
`)}formatPolymers(t){let n=[];const r=()=>({chainIdentifier:"",residues:[],kind:O.Unknown}),s=()=>new Rt,a=()=>{o.hash=wt(),i.residues.push(o)};let i=r(),o=s();const p=b=>{let u={[O.DNA]:0,[O.RNA]:0,[O.Protein]:0};return b===void 0?u:[u,Object.keys(b).reduce((B,M)=>b[B]>b[M]?B:M)]};let g=p(),A=[],x={chains:[],rotations:[],translations:[c.infinity()]},z=!1;const P=()=>{x={chains:[],rotations:[],translations:[c.infinity()]}};let h=!1,w=0,N=0;const v=t.split(`
`);for(let b=0;b<v.length;b++){const u=v[b];if(!(h&&N>1)){if(u.startsWith("NUMMDL")&&(h=!0,w=parseInt(u.slice(10,14).trim()),console.log("NUMBER OF MODELS:",w)),u.startsWith("MODEL")&&(N=parseInt(u.slice(11,14).trim())),u.startsWith("ATOM")||u.startsWith("HETATM")){let B=parseFloat(u.slice(30,38).trim()),M=parseFloat(u.slice(38,46).trim()),f=parseFloat(u.slice(46,54).trim()),I=u.slice(12,16).trim(),j=u.slice(17,20).trim(),D=u.slice(76,78).trim(),E=parseInt(u.slice(22,26).trim()),W=u.slice(21,22);i.chainIdentifier=W;const L={coords:new Z(B,M,f),name:I,element:D,residueName:j,residueSequenceNumber:E};g[Ut(L)]++,o.sequenceNumber===-1&&(o.name=L.residueName,o.sequenceNumber=E,o.polymerChainIdentifier=W),E!==o.sequenceNumber&&(a(),o=s(),o.name=L.residueName,o.sequenceNumber=E,o.polymerChainIdentifier=W),o.atoms.push(L)}if(u.startsWith("TER")||b===v.length-1){a();let[B,M]=p(g);g=B,i.kind=M,i=gt(i),n.push(i),i=r(),o=s()}if(u.startsWith("REMARK 350")){if(z=!0,["REMARK 350 APPLY THE FOLLOWING TO CHAINS: ","REMARK 350                    AND CHAINS:"].forEach((M,f)=>{if(u.startsWith(M)){let I=u.trim().slice(M.length-1,u.length).toString().replaceAll(" ","").split(",");f===0&&(P(),x.chains.length>0&&A.push(x)),I.length>0&&x.chains.push(...I)}}),u.startsWith("REMARK 350   BIOMT")){let f=u.replace("REMARK 350   BIOMT","").match(new RegExp(/(\d{1})\s*(\d{1})\s*([+-]?[0-9]*[.]?[0-9]+)\s*([+-]?[0-9]*[.]?[0-9]+)\s*([+-]?[0-9]*[.]?[0-9]+)\s*([+-]?[0-9]*[.]?[0-9]+)/));if(f!=null&&f.length===6+1){f=f.slice(1);let I=parseInt(f[1])-1,j=parseInt(f[0])-1,D=[parseFloat(f[2]),parseFloat(f[3]),parseFloat(f[4])],E=parseFloat(f[5]);typeof x.translations[I]=="undefined"&&(x.translations[I]=c.infinity()),x.translations[I].setIndex(j,E),Array.isArray(x.rotations[I])||(x.rotations[I]=[]),x.rotations[I][j]=D}}}else z&&(A.push(x),P()),z=!1}}return A.forEach(b=>{const u=n.filter(f=>b.chains.indexOf(f.chainIdentifier)!==-1),B=b.rotations.slice(1),M=b.translations.slice(1);B.forEach((f,I)=>{u.forEach(j=>{let D=Wt(j,{includeNonEnumerable:!0});D.chainIdentifier=D.chainIdentifier+(I+1).toString(),D.generatedFromTransform=!0,D.residues.forEach((E,W)=>{E.polymerChainIdentifier=D.chainIdentifier,E.atoms.forEach((L,R)=>{let k=L.coords.toVec(),$=c.infinity();console.log("Coorinates before:",k),$.x=k.x*f[0][0]+k.y*f[0][1]+k.z*f[0][2],$.y=k.x*f[1][0]+k.y*f[1][1]+k.z*f[1][2],$.z=k.x*f[2][0]+k.y*f[2][1]+k.z*f[2][2];const U=M[I];$=$.add(U),console.log("Coords after:",$),console.log("Distance between atoms: ",$.distanceTo(k)),L.coords=$.toCoord(),E.atoms[R]=L}),E.hash=wt(),D.residues[W]=E}),D=gt(D),n.push(D)})})}),console.log("Transformations:",A),console.log("Result after translation",n),n}}const se=async e=>await(await fetch(`https://files.rcsb.org/download/${e}.pdb`)).text();function ie(){var P;const[e,t]=F.exports.useContext(Y),n=()=>{t({type:"isLoading",payload:!0})},r=()=>{t({type:"isLoading",payload:!1})},s=h=>{t({type:"pdb",payload:h})},a=h=>{t({type:"currentPDBId",payload:h})},i=h=>{t({type:"polymers",payload:h})},o=()=>{t({type:"resetState",payload:null})},p=async h=>{o(),n();const w=new Nt().format(await se(h));s(w),i(w.polymers),a(h),r()};F.exports.useEffect(()=>{const w=new URLSearchParams(window.location.search).get("id");console.log("ID",w),w!==null&&p(w)},[]);const g=async h=>{var N;let w=(N=h.target.files)==null?void 0:N.item(0);if(w!==null){o(),n(),console.time("TIME_TO_PARSE_EVERYTHING"),console.time("TIME_TO_PARSE_PDB");const v=await new Nt(w).readData();console.timeEnd("TIME_TO_PARSE_PDB"),s(v),i(v.polymers),console.timeEnd("TIME_TO_PARSE_EVERYTHING"),setTimeout(r,2e3)}};let A;e.polymers.length>0&&(A=y("div",{className:"mt-5",children:[d("div",{className:"mb-1",children:"Provided input file"}),d("textarea",{className:"text-sm w-full border h-96 border-blue-100",value:(P=e.pdb)==null?void 0:P.raw,readOnly:!0})]}));const x=F.exports.useRef(null),z=()=>{var w;const h=(w=x.current)==null?void 0:w.value;h&&p(h)};return y("div",{className:"p-5 max-h-screen overflow-auto break-words",children:[!e.isLoading&&y("div",{children:[e.error.length>0&&d("div",{className:"mb-4",children:y("div",{className:"text-red-700 font-bold text-lg",children:["Something went wrong: ",e.error]})}),e.pdb===void 0&&d("div",{className:"text-sm text-gray-600 mb-4 bg-red-200 p-2",children:"Choose a PDB file which contains DNA/RNA with Proteins"}),y("div",{children:[e.currentPDBId.length>0&&y("div",{className:"mb-4",children:["Currently selected PDB ID:",d("b",{children:e.currentPDBId.toUpperCase()})]}),y("div",{className:"mb-4",children:[y("div",{className:"text-normal font-bold text-gray-600 mb-2",children:["Enter PDB file ID:",y("div",{className:"text-xs font-normal",children:["PDB file should contain ",d("b",{children:"DNA/RNA"})," structures"]})]}),y("div",{className:"flex flex-row max-w-full",children:[d("input",{onKeyPress:h=>{h.key==="Enter"&&z()},ref:x,placeholder:"1ZS4",className:"border-r-0 outline-none ring-indigo-200 focus:ring-2 transition-all block py-1 px-2 outline-0 border border-indigo-300 rounded rounded-tr-none rounded-br-none"}),d("button",{onClick:z,className:"bg-indigo-400 border-l-0 text-white font-bold text-sm ring-indigo-200 focus:ring-2 hover:bg-indigo-600 transition-all w-[100px]  block rounded rounded-tl-none rounded-bl-none border border-indigo-300",children:"GO"})]})]}),y("div",{className:"text-normal font-bold text-gray-600 mb-2",children:["Or choose a PDB file to display:",y("div",{className:"text-xs font-normal",children:["PDB file should contain ",d("b",{children:"DNA/RNA"})," structures"]})]}),d("input",{type:"file",onChange:g,className:"max-w-full"})]})]}),A,e.pdb&&y("div",{children:["Polymers from input:",e.polymers.map(({residues:h,chainIdentifier:w,kind:N},v)=>y("div",{className:"ml-2",children:["Chain:"," ",y("b",{children:[w," (",N,")"]}),d("div",{className:"ml-2",children:h.map((b,u)=>y("span",{children:[b.name," \xA0"]},u))})]},v))]})]})}const oe=()=>y("div",{className:"flex flex-col items-center gap-1",children:[d("div",{className:"text-white font-bold",children:"Loading"}),y("div",{className:"lds-roller",children:[d("div",{}),d("div",{}),d("div",{}),d("div",{}),d("div",{}),d("div",{}),d("div",{}),d("div",{})]})]});function ae(){const e=F.exports.useContext(Y)[0];return y("div",{className:"w-full flex flex-row",children:[e.isLoading===!0&&d("div",{className:"fixed w-screen min-h-screen top-0 left-0 flex items-center justify-center z-50  h-full",style:{backgroundColor:"rgba(0,0,0,0.75)"},children:d(oe,{})}),d("div",{className:"z-10 w-9/12 bg-indigo-200 min-h-full h-screen",children:d(re,{})}),d("div",{className:"z-10 w-3/12",children:d(ie,{})})]})}function le({children:e}){return d(Vt,{children:e})}const ce="modulepreload",Ct={},he="/",de=function(t,n){return!n||n.length===0?t():Promise.all(n.map(r=>{if(r=`${he}${r}`,r in Ct)return;Ct[r]=!0;const s=r.endsWith(".css"),a=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${a}`))return;const i=document.createElement("link");if(i.rel=s?"stylesheet":ce,s||(i.as="script",i.crossOrigin=""),i.href=r,document.head.appendChild(i),s)return new Promise((o,p)=>{i.addEventListener("load",o),i.addEventListener("error",p)})})).then(()=>t())},ue=e=>{e&&e instanceof Function&&de(()=>import("./web-vitals.d62816c8.js"),[]).then(({getCLS:t,getFID:n,getFCP:r,getLCP:s,getTTFB:a})=>{t(e),n(e),r(e),s(e),a(e)})};qt.render(d(rt.StrictMode,{children:d(le,{children:d(ae,{})})}),document.getElementById("root"));ue();
