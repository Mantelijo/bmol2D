var Tt=Object.defineProperty;var ct=Object.getOwnPropertySymbols;var Mt=Object.prototype.hasOwnProperty,Et=Object.prototype.propertyIsEnumerable;var X=(e,t,n)=>t in e?Tt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,tt=(e,t)=>{for(var n in t||(t={}))Mt.call(t,n)&&X(e,n,t[n]);if(ct)for(var n of ct(t))Et.call(t,n)&&X(e,n,t[n]);return e};var M=(e,t,n)=>(X(e,typeof t!="symbol"?t+"":t,n),n);import{j as et,r as W,m as ht,l as vt,s as Ot,a as nt,d as St,z as Bt,i as $t,b as Lt,R as rt,c as Pt,e as Gt}from"./vendor.81ab7bc9.js";const jt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}};jt();class c{constructor(t,n,r){this.x=t,this.y=n,this.z=r,this.x=t||0,this.y=n||0,this.z=r||0}negative(){return new c(-this.x,-this.y,-this.z)}add(t){return t instanceof c?new c(this.x+t.x,this.y+t.y,this.z+t.z):new c(this.x+t,this.y+t,this.z+t)}subtract(t){return t instanceof c?new c(this.x-t.x,this.y-t.y,this.z-t.z):new c(this.x-t,this.y-t,this.z-t)}multiply(t){return t instanceof c?new c(this.x*t.x,this.y*t.y,this.z*t.z):new c(this.x*t,this.y*t,this.z*t)}divide(t){return t instanceof c?new c(this.x/t.x,this.y/t.y,this.z/t.z):new c(this.x/t,this.y/t,this.z/t)}equals(t){return this.x==t.x&&this.y==t.y&&this.z==t.z}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return new c(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}length(){return Math.sqrt(this.dot(this))}magnitude(){return this.length()}unit(){return this.divide(this.length())}min(){return Math.min(Math.min(this.x,this.y),this.z)}max(){return Math.max(Math.max(this.x,this.y),this.z)}toAngles(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length())}}angleTo(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}toArray(t){return[this.x,this.y,this.z].slice(0,t||3)}toCoord(){return new R(this.x,this.y,this.z)}clone(){return new c(this.x,this.y,this.z)}init(t,n,r){return this.x=t,this.y=n,this.z=r,this}normalize(){return this.unit()}setIndex(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break}}distanceTo(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)+Math.pow(this.z-t.z,2))}static negative(t,n,r){return n.x=-t.x,n.y=-t.y,n.z=-t.z,n}static add(t,n,r){return n instanceof c?(r.x=t.x+n.x,r.y=t.y+n.y,r.z=t.z+n.z):(r.x=t.x+n,r.y=t.y+n,r.z=t.z+n),r}static subtract(t,n,r){return n instanceof c?(r.x=t.x-n.x,r.y=t.y-n.y,r.z=t.z-n.z):(r.x=t.x-n,r.y=t.y-n,r.z=t.z-n),r}static multiply(t,n,r){return n instanceof c?(r.x=t.x*n.x,r.y=t.y*n.y,r.z=t.z*n.z):(r.x=t.x*n,r.y=t.y*n,r.z=t.z*n),r}static divide(t,n,r){return n instanceof c?(r.x=t.x/n.x,r.y=t.y/n.y,r.z=t.z/n.z):(r.x=t.x/n,r.y=t.y/n,r.z=t.z/n),r}static cross(t,n,r){return r.x=t.y*n.z-t.z*n.y,r.y=t.z*n.x-t.x*n.z,r.z=t.x*n.y-t.y*n.x,r}static unit(t,n,r){var s=t.length();return n.x=t.x/s,n.y=t.y/s,n.z=t.z/s,n}static fromAngles(t,n){return new c(Math.cos(t)*Math.cos(n),Math.sin(n),Math.sin(t)*Math.cos(n))}static randomDirection(){return c.fromAngles(Math.random()*Math.PI*2,Math.asin(Math.random()*2-1))}static min(t,n,r){return new c(Math.min(t.x,n.x),Math.min(t.y,n.y),Math.min(t.z,n.z))}static max(t,n,r){return new c(Math.max(t.x,n.x),Math.max(t.y,n.y),Math.max(t.z,n.z))}static lerp(t,n,r){return n.subtract(t).multiply(r).add(t)}static fromArray(t){return new c(t[0],t[1],t[2])}static angleBetween(t,n,r){return t.angleTo(n)}static infinity(){return new c(1/0,1/0,1/0)}}class R{constructor(t,n,r){this.x=t,this.y=n,this.z=r}toVec(){return c.fromArray(this.toArray())}toArray(){return[this.x,this.y,this.z]}}var dt;(function(e){e.A="\u03B1",e.B="\u03B2",e.G="\u03B3",e.D="\u03B4",e.E="\u03B5",e.Z="\u03B6",e.H="\u03B7"})(dt||(dt={}));class Wt{constructor(){M(this,"center");M(this,"interactions");M(this,"atoms");M(this,"v");M(this,"o");M(this,"hash");M(this,"name");M(this,"sequenceNumber");M(this,"polymerChainIdentifier");this.atoms=[],this.name="",this.sequenceNumber=-1,this.center=new R(-1,-1,-1),this.hash="",this.interactions=[],this.polymerChainIdentifier="",this.v=c.infinity(),this.o=c.infinity()}findAtomsByNames(t){let n=[];return this.atoms.forEach(r=>{t.indexOf(r.name)!==-1&&n.push(r)}),n.sort((r,s)=>t.indexOf(r.name)-t.indexOf(s.name)),n}}var p;(function(e){e.DA="DA",e.DG="DG",e.DC="DC",e.DT="DT",e.CM="5CM"})(p||(p={}));var C;(function(e){e.A="A",e.C="C",e.G="G",e.I="I",e.U="U"})(C||(C={}));var ut;(function(e){e[e.Ala=0]="Ala",e[e.Arg=1]="Arg",e[e.Asn=2]="Asn",e[e.Asp=3]="Asp",e[e.Cys=4]="Cys",e[e.Glu=5]="Glu",e[e.Gln=6]="Gln",e[e.Gly=7]="Gly",e[e.His=8]="His",e[e.Ile=9]="Ile",e[e.Leu=10]="Leu",e[e.Lys=11]="Lys",e[e.Met=12]="Met",e[e.Phe=13]="Phe",e[e.Pro=14]="Pro",e[e.Ser=15]="Ser",e[e.Thr=16]="Thr",e[e.Trp=17]="Trp",e[e.Tyr=18]="Tyr",e[e.Val=19]="Val"})(ut||(ut={}));var O;(function(e){e.DNA="DNA",e.RNA="RNA",e.Protein="Protein",e.Unknown="Unknown"})(O||(O={}));function Ft(e){switch(!0){case e.residueName in p:return O.DNA;case e.residueName in C:return O.RNA;default:return O.Protein}}function ft(e){return`${e.residueName}${e.residueSequenceNumber}:${e.name}`}const d=et.exports.jsx,I=et.exports.jsxs,Ht=et.exports.Fragment,st={polymers:[],pdb:void 0,isLoading:!1,simpleStuffy:"",hashedNucleicAcidResidues:{},viz:{chain1:null,chain2:null},currentPDBId:"",selectedResidue:void 0,error:"",getResidue:function(e,t){if(this.polymers.length===0)return null;const n=this.polymers.filter(r=>r.chainIdentifier===e);if(n.length>0){const r=n[0].residues.filter(s=>s.hash===t);if(r.length>0)return r[0]}return null}},Z=W.exports.createContext([st,()=>{}]),qt=(e,{type:t,payload:n})=>{switch(t){case"resetState":return tt({},st);default:if(t in e)e[t]=n;else throw new Error(`${t} not found in state`)}return tt({},e)},Ut=({children:e})=>{const[t,n]=W.exports.useReducer(qt,st);return d(Z.Provider,{value:[t,n],children:e})};function mt(e){return e.residues.forEach((t,n)=>{const r=new R(0,0,0);t.atoms.forEach(s=>{r.x+=s.coords.x,r.y+=s.coords.y,r.z+=s.coords.z}),r.x=r.x/t.atoms.length,r.y=r.y/t.atoms.length,r.z=r.z/t.atoms.length,e.residues[n].center=r}),e}var it;(function(e){e[e.Threshold=0]="Threshold",e[e.HBond=1]="HBond"})(it||(it={}));const Kt=1.42,yt=e=>{if([O.DNA,O.RNA].indexOf(e.kind)!=-1){let t=["C2","C4","C6"];e.residues.forEach(n=>{let r=[];if(n.findAtomsByNames(t).forEach((a,i)=>{r[i]=a.coords}),r.length===3){const a=c.fromArray(r[0].toArray()),i=c.fromArray(r[1].toArray()),o=c.fromArray(r[2].toArray()),x=i.subtract(a).cross(o.subtract(a)).normalize(),g=a.add(i).add(o).divide(3);n.v=x,n.o=g}})}return e};function pt(e,t){const n=[[p.DA,p.DT],[p.DA,C.U],[p.DT,C.A],[p.DC,p.DG],[p.DC,C.G],[p.DG,p.DC],[p.DG,C.C],[C.C,C.G],[C.A,C.U],[p.CM,p.DG],[p.CM,C.G]];for(let r=0;r<n.length;r++)if(e.name===n[r][0]&&t.name===n[r][1]||e.name===n[r][1]&&t.name===n[r][0])return!0;return!1}const F=e=>`${e.polymerChainIdentifier}:${e.name}${e.sequenceNumber}`;class _t{constructor(t){M(this,"nucleicAcids",[]);M(this,"proteins",[]);M(this,"hasValidDNA",!1);M(this,"hasValidRNA",!1);M(this,"visualization",{chain1:null,chain2:null});this.polymers=t,this.prepareObjects()}generateWatsonCrickPairs(t,n){let r=this.calculateWatsonCrickPairs(t,n),s=this.calculateWatsonCrickPairs(n,t);s.reverse();let a=r;return s.forEach(i=>{if(i.length===1)a.push(i);else if(i.length===2){let o=!1;for(let x=0;x<r.length;x++){let g=r[x];if(g.length===2&&g[0].hash===i[1].hash&&g[1].hash===i[0].hash){o=!0;break}}o||console.log(`watsonCrickPairs: matching pair was not found ${i[1].polymerChainIdentifier}:${i[1].sequenceNumber}${i[1].name}---${i[0].polymerChainIdentifier}:${i[0].sequenceNumber}${i[0].name}`,i)}}),a}watsonCrickPairs(){if(this.nucleicAcids.length<=0)throw Error("Nucleic acids are not initialized");let t=[];for(let n=0;n<this.nucleicAcids.length;n++){for(let s=n+1;s<this.nucleicAcids.length;s++){const a=this.generateWatsonCrickPairs(this.nucleicAcids[n],this.nucleicAcids[s]);t.push(...a)}const r=this.generateWatsonCrickPairs(this.nucleicAcids[n],this.nucleicAcids[n]);r.length>0&&(console.log("SIMILAR PAIRS",r),t.push(...r))}return t}calculateWatsonCrickPairs(t,n){let r=[];return t.residues.forEach(s=>{let a=1/0,i;if(n.residues.forEach(o=>{let x=1/0,g=[1/0],A=[1/0];const m=s.findAtomsByNames(["C2","C4","C6"]);m.length==3&&(g=[Math.abs(m[0].coords.toVec().subtract(o.o).dot(o.v)),Math.abs(m[1].coords.toVec().subtract(o.o).dot(o.v)),Math.abs(m[2].coords.toVec().subtract(o.o).dot(o.v))]);const z=o.findAtomsByNames(["C2","C4","C6"]);z.length==3&&(A=[Math.abs(z[0].coords.toVec().subtract(s.o).dot(s.v)),Math.abs(z[1].coords.toVec().subtract(s.o).dot(s.v)),Math.abs(z[2].coords.toVec().subtract(s.o).dot(s.v))]),x=Math.max(...A,...g),x<a&&s.hash!==o.hash&&(a=x,i=o)}),i!==void 0&&a<=Kt+Math.random()&&pt(i,s)&&s.center.toVec().distanceTo(i.center.toVec())<15){r.push([s,i]);const o=i;console.log("Smallest distance: ",`${t.kind}-${s.polymerChainIdentifier}:${s.sequenceNumber}${s.name}`,`${n.kind}-${o.polymerChainIdentifier}:${o.sequenceNumber}${o.name}`,a,pt(i,s))}else r.push([s]),console.log(`No pair for: ${t.kind} ${s.polymerChainIdentifier}:${s.sequenceNumber}${s.name}, smallest distance: ${a}`,i)}),r}prepareObjects(){this.nucleicAcids=this.findNucleicAcids(),this.proteins=this.findProteins(),this.nucleicAcids.forEach(t=>mt(t)),this.proteins.forEach(t=>mt(t))}findProteins(){return this.polymers.filter(t=>[O.Protein].indexOf(t.kind)!==-1)}findNucleicAcids(){return this.polymers.filter(t=>[O.DNA,O.RNA].indexOf(t.kind)!==-1)}simpleInteractions(){const t=4,n=10;this.nucleicAcids.forEach(r=>{r.residues.forEach(s=>{this.proteins.forEach(a=>{a.residues.forEach(i=>{let o=i.findAtomsByNames(["CA"]);if(o.length>0){const x=o[0],g=s.center.toVec().distanceTo(x.coords.toVec());g<=n&&(console.log(`Possible interaction between: ${F(i)} and ${F(s)} (${g})`),s.atoms.forEach(A=>{i.atoms.forEach(m=>{const z=A.coords.toVec().distanceTo(m.coords.toVec());if(z<=t){console.log(`	Interaction between: ${ft(m)} and ${ft(A)} (${z})`);const $={polymerKind:O.Protein,type:it.Threshold,polymerChainIdentifier:i.polymerChainIdentifier,residueHash:i.hash,atom:m};s.interactions.push($)}})}))}})})})})}}var H;(function(e){e.Pair="pair",e.Backbone="backbone",e.Interaction="interaction"})(H||(H={}));const Y={size:10,y:4},Vt=100;function Rt({nodes:e,links:t,svgRef:n,dispatch:r},s){let{nodeId:a=l=>l.id,nodeGroups:i,nodeTitle:o,nodeFill:x=l=>l.color!==void 0?l.color:"currentColor",nodeStroke:g="#fff",nodeStrokeWidth:A=1.5,nodeStrokeOpacity:m=1,nodeRadius:z=10,linkStroke:$=l=>l.color!==void 0?l.color:"#444",linkStrokeOpacity:h=.6,linkStrokeWidth:y=1.5,linkStrokeLinecap:w="round",width:D=640,height:N=400,invalidation:u}=s;const L=e,k=t,f=ht(e,a).map(zt);o===void 0&&(o=(l,j)=>f[j]);const b=typeof y!="function"?null:ht(t,y);e=L,t=k;const q=Lt(),E=vt(t).id(({index:l})=>f[l]).distance((l,j)=>{switch(k[j].linkType){case H.Backbone:return 4;case H.Interaction:return 10;default:return 30}}).strength((l,j)=>{switch(k[j].linkType){case H.Backbone:return 1.8;case H.Interaction:return 1;default:return 1.2}}),v=Ot(e).force("link",E).force("nodes",q).on("tick",It),P=nt(n).attr("width",D).attr("height",N).attr("viewBox",[-D/2,-N/2,D,N]).attr("style","max-width: 100%; height: auto; height: intrinsic;");P.html("");const B=P.append("g"),_=B.append("g").attr("stroke-opacity",h).attr("stroke-width",typeof y!="function"?y:null).attr("stroke-linecap",w).selectAll("line").data(t).join("line").attr("stroke-dasharray",l=>l.linkType==="pair"?"4":null).attr("stroke",$),T=B.append("g").selectAll("g").data(e).enter().append("g").call(bt(v)),G=T.append("circle").attr("stroke",g).attr("stroke-opacity",m).attr("stroke-width",A).attr("fill",x).style("cursor","pointer").attr("r",z);let V=new Date;T.on("mouseover",function(l,j){nt(this).select("circle").attr("r",at(z*2)),new Date().getTime()-V.getTime()>Vt&&(V=new Date)}).on("mouseout",function(l,j){nt(this).select("circle").attr("r",at(z))});const Ct=T.append("text").text(l=>l.name).attr("text-anchor","middle").attr("font-size",Y.size).attr("y",Y.y).attr("class","svg-graph-text");b&&_.attr("stroke-width",l=>b[l.index]),u!=null&&u.then(()=>v.stop());function zt(l){return l!==null&&typeof l=="object"?l.valueOf():l}function It(){_.attr("x1",l=>l.source.x).attr("y1",l=>l.source.y).attr("x2",l=>l.target.x).attr("y2",l=>l.target.y),T.attr("transform",l=>`translate(${l.x}, ${l.y})`)}function bt(l){function j(S){S.active||l.alphaTarget(.3).restart(),S.subject.fx=S.subject.x,S.subject.fy=S.subject.y}function Dt(S){S.subject.fx=S.x,S.subject.fy=S.y}function kt(S){S.active||l.alphaTarget(0),S.subject.fx=null,S.subject.fy=null}return St().on("start",j).on("drag",Dt).on("end",kt)}const at=l=>U?l/U:l;let Q,U;const lt=Bt().on("zoom",l=>{B.attr("transform",Q=l.transform),Q&&(U=Math.sqrt(Q.k),B.style("stroke-width",3/U),G.attr("r",z/U).attr("stroke-width",A/U),Ct.attr("font-size",Y.size/U).attr("y",Y.y/U))});return P.call(lt).call(lt.transform,$t),Object.assign(P.node(),{scales:{color:null}})}const xt={[p.DA]:"#fcb331",[p.DT]:"#5670fb",[p.DG]:"#f63c37",[p.DC]:"#03c907",[p.CM]:"#03c907",[C.A]:"#acb331",[C.U]:"#a670fb",[C.G]:"#a63c37",[C.C]:"#a3c907",[C.I]:"#a3c907",interaction:"#333"},J="red",K="blue",gt={[p.DA]:J,[p.DT]:J,[p.DG]:K,[p.DC]:K,[p.CM]:K,[C.A]:J,[C.U]:J,[C.G]:K,[C.C]:K,[C.I]:K,interaction:"#718355"},Zt="#494949";function Yt(){const[e,t]=W.exports.useContext(Z),n=e.polymers;let r=rt.createRef(),s=rt.createRef(),a=W.exports.useRef(null);function i(){if(!r||n.length<=0)return;console.time("Nucleic_acid_VIZ");const o=new _t(n);let x;try{x=o.watsonCrickPairs()}catch(h){console.log(h),t({type:"error",payload:h.toString()});return}o.simpleInteractions();let g=[],A=[];const m=h=>{const y=Object.values(p);h.residues.forEach((w,D)=>{g.push({hash:w.hash,name:w.name.toString().slice(-1),id:F(w),color:xt[w.name],group:y.indexOf(w.name)+1});let N=h.residues;if(D>0&&D<N.length&&A.push({source:F(N[D-1]),target:F(w),value:1,color:Zt,linkType:H.Backbone}),w.interactions.length>0){const u=F(w)+"-interactions";g.push({hash:w.hash,name:w.interactions.length.toString(),id:u,color:xt.interaction,group:5}),A.push({source:u,target:F(w),value:1,color:gt.interaction,linkType:H.Interaction})}})};o.nucleicAcids.forEach(h=>m(h)),x.forEach(h=>{const y=h[0];if(h.length===2){const w=h[1];A.push({source:F(w),target:F(y),value:1,color:gt[y.name],linkType:H.Pair})}}),console.log("Vizualization data:",g,A);let[z,$]=[a.current.offsetWidth,a.current.offsetHeight];Rt({nodes:g,links:A,svgRef:r.current,dispatch:t},{width:z,height:$}),console.timeEnd("Nucleic_acid_VIZ")}return W.exports.useEffect(i,[n]),I(Ht,{children:[d("div",{children:e.simpleStuffy}),I("div",{className:"p-5 flex items-center flex-col h-full",ref:a,children:[d("div",{className:"min-w-full h-full relative",children:d("svg",{ref:r})}),d("div",{ref:s,style:{position:"absolute",opacity:0,background:"#fff"}})]})]})}const wt=new Set,ot=()=>{const e=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16));return wt.has(e)?ot():(wt.add(e),e)};class At{constructor(t){M(this,"file");t!==void 0&&(this.file=t)}async readData(){if(this.file==null)throw Error("file not provided");let t=await this.file.text();return this.format(t)}format(t){return{raw:this.formatText(t),polymers:this.formatPolymers(t)}}formatText(t){return t.split(`
`).map((n,r)=>r.toString()+". "+n).join(`
`)}formatPolymers(t){let n=[];const r=()=>({chainIdentifier:"",residues:[],kind:O.Unknown}),s=()=>new Wt,a=()=>{o.hash=ot(),i.residues.push(o)};let i=r(),o=s();const x=N=>{let u={[O.DNA]:0,[O.RNA]:0,[O.Protein]:0};return N===void 0?u:[u,Object.keys(N).reduce((L,k)=>N[L]>N[k]?L:k)]};let g=x(),A=[],m={chains:[],rotations:[],translations:[c.infinity()]},z=!1;const $=()=>{m={chains:[],rotations:[],translations:[c.infinity()]}};let h=!1,y=0,w=0;const D=t.split(`
`);for(let N=0;N<D.length;N++){const u=D[N];if(!(h&&w>1)){if(u.startsWith("NUMMDL")&&(h=!0,y=parseInt(u.slice(10,14).trim()),console.log("NUMBER OF MODELS:",y)),u.startsWith("MODEL")&&(w=parseInt(u.slice(11,14).trim())),u.startsWith("ATOM")||u.startsWith("HETATM")){let L=parseFloat(u.slice(30,38).trim()),k=parseFloat(u.slice(38,46).trim()),f=parseFloat(u.slice(46,54).trim()),b=u.slice(12,16).trim(),q=u.slice(17,20).trim(),E=u.slice(76,78).trim(),v=parseInt(u.slice(22,26).trim()),P=u.slice(21,22);i.chainIdentifier=P;const B={coords:new R(L,k,f),name:b,element:E,residueName:q,residueSequenceNumber:v};g[Ft(B)]++,o.sequenceNumber===-1&&(o.name=B.residueName,o.sequenceNumber=v,o.polymerChainIdentifier=P),v!==o.sequenceNumber&&(a(),o=s(),o.name=B.residueName,o.sequenceNumber=v,o.polymerChainIdentifier=P),o.atoms.push(B)}if(u.startsWith("TER")||N===D.length-1){a();let[L,k]=x(g);g=L,i.kind=k,i=yt(i),n.push(i),i=r(),o=s()}if(u.startsWith("REMARK 350")){if(z=!0,["REMARK 350 APPLY THE FOLLOWING TO CHAINS: ","REMARK 350                    AND CHAINS:"].forEach((k,f)=>{if(u.startsWith(k)){let b=u.trim().slice(k.length-1,u.length).toString().replaceAll(" ","").split(",");f===0&&($(),m.chains.length>0&&A.push(m)),b.length>0&&m.chains.push(...b)}}),u.startsWith("REMARK 350   BIOMT")){let f=u.replace("REMARK 350   BIOMT","").match(new RegExp(/(\d{1})\s*(\d{1})\s*([+-]?[0-9]*[.]?[0-9]+)\s*([+-]?[0-9]*[.]?[0-9]+)\s*([+-]?[0-9]*[.]?[0-9]+)\s*([+-]?[0-9]*[.]?[0-9]+)/));if(f!=null&&f.length===6+1){f=f.slice(1);let b=parseInt(f[1])-1,q=parseInt(f[0])-1,E=[parseFloat(f[2]),parseFloat(f[3]),parseFloat(f[4])],v=parseFloat(f[5]);typeof m.translations[b]=="undefined"&&(m.translations[b]=c.infinity()),m.translations[b].setIndex(q,v),Array.isArray(m.rotations[b])||(m.rotations[b]=[]),m.rotations[b][q]=E}}}else z&&(A.push(m),$()),z=!1}}return A.forEach(N=>{const u=n.filter(f=>N.chains.indexOf(f.chainIdentifier)!==-1),L=N.rotations.slice(1),k=N.translations.slice(1);L.forEach((f,b)=>{u.forEach(q=>{let E=Pt(q,{includeNonEnumerable:!0});E.chainIdentifier=E.chainIdentifier+(b+1).toString(),E.generatedFromTransform=!0,E.residues.forEach((v,P)=>{v.polymerChainIdentifier=E.chainIdentifier,v.atoms.forEach((B,_)=>{let T=B.coords.toVec(),G=c.infinity();console.log("Coorinates before:",T),G.x=T.x*f[0][0]+T.y*f[0][1]+T.z*f[0][2],G.y=T.x*f[1][0]+T.y*f[1][1]+T.z*f[1][2],G.z=T.x*f[2][0]+T.y*f[2][1]+T.z*f[2][2];const V=k[b];G=G.add(V),console.log("Coords after:",G),console.log("Distance between atoms: ",G.distanceTo(T)),B.coords=G.toCoord(),v.atoms[_]=B}),v.hash=ot(),E.residues[P]=v}),E=yt(E),n.push(E)})})}),console.log("Transformations:",A),console.log("Result after translation",n),n}}const Jt=async e=>await(await fetch(`https://files.rcsb.org/download/${e}.pdb`)).text();function Qt(){var $;const[e,t]=W.exports.useContext(Z),n=()=>{t({type:"isLoading",payload:!0})},r=()=>{t({type:"isLoading",payload:!1})},s=h=>{t({type:"pdb",payload:h})},a=h=>{t({type:"currentPDBId",payload:h})},i=h=>{t({type:"polymers",payload:h})},o=()=>{t({type:"resetState",payload:null})},x=async h=>{o(),n();const y=new At().format(await Jt(h));s(y),i(y.polymers),a(h),r()};W.exports.useEffect(()=>{const y=new URLSearchParams(window.location.search).get("id");console.log("ID",y),y!==null&&x(y)},[]);const g=async h=>{var w;let y=(w=h.target.files)==null?void 0:w.item(0);if(y!==null){o(),n(),console.time("TIME_TO_PARSE_EVERYTHING"),console.time("TIME_TO_PARSE_PDB");const D=await new At(y).readData();console.timeEnd("TIME_TO_PARSE_PDB"),s(D),i(D.polymers),console.timeEnd("TIME_TO_PARSE_EVERYTHING"),setTimeout(r,2e3)}};let A;e.polymers.length>0&&(A=I("div",{className:"mt-5",children:[d("div",{className:"mb-1",children:"Provided input file"}),d("textarea",{className:"text-sm w-full border h-96 border-blue-100",value:($=e.pdb)==null?void 0:$.raw,readOnly:!0})]}));const m=W.exports.useRef(null),z=()=>{var y;const h=(y=m.current)==null?void 0:y.value;h&&x(h)};return I("div",{className:"p-5 max-h-screen overflow-auto break-words",children:[!e.isLoading&&I("div",{children:[e.error.length>0&&d("div",{className:"mb-4",children:I("div",{className:"text-red-700 font-bold text-lg",children:["Something went wrong: ",e.error]})}),e.pdb===void 0&&d("div",{className:"text-sm text-gray-600 mb-4 bg-red-200 p-2",children:"Choose a PDB file which contains DNA/RNA with Proteins"}),I("div",{children:[e.currentPDBId.length>0&&I("div",{className:"mb-4",children:["Currently selected PDB ID:",d("b",{children:e.currentPDBId.toUpperCase()})]}),I("div",{className:"mb-4",children:[I("div",{className:"text-normal font-bold text-gray-600 mb-2",children:["Enter PDB file ID:",I("div",{className:"text-xs font-normal",children:["PDB file should contain ",d("b",{children:"DNA/RNA"})," structures"]})]}),I("div",{className:"flex flex-row max-w-full",children:[d("input",{onKeyPress:h=>{h.key==="Enter"&&z()},ref:m,placeholder:"1ZS4",className:"border-r-0 outline-none ring-indigo-200 focus:ring-2 transition-all block py-1 px-2 outline-0 border border-indigo-300 rounded rounded-tr-none rounded-br-none"}),d("button",{onClick:z,className:"bg-indigo-400 border-l-0 text-white font-bold text-sm ring-indigo-200 focus:ring-2 hover:bg-indigo-600 transition-all w-[100px]  block rounded rounded-tl-none rounded-bl-none border border-indigo-300",children:"GO"})]})]}),I("div",{className:"text-normal font-bold text-gray-600 mb-2",children:["Or choose a PDB file to display:",I("div",{className:"text-xs font-normal",children:["PDB file should contain ",d("b",{children:"DNA/RNA"})," structures"]})]}),d("input",{type:"file",onChange:g,className:"max-w-full"})]})]}),A,e.pdb&&I("div",{children:["Polymers from input:",e.polymers.map(({residues:h,chainIdentifier:y,kind:w},D)=>I("div",{className:"ml-2",children:["Chain:"," ",I("b",{children:[y," (",w,")"]}),d("div",{className:"ml-2",children:h.map((N,u)=>I("span",{children:[N.name," \xA0"]},u))})]},D))]})]})}const Xt=()=>I("div",{className:"flex flex-col items-center gap-1",children:[d("div",{className:"text-white font-bold",children:"Loading"}),I("div",{className:"lds-roller",children:[d("div",{}),d("div",{}),d("div",{}),d("div",{}),d("div",{}),d("div",{}),d("div",{}),d("div",{})]})]});function te(){const e=W.exports.useContext(Z)[0];return I("div",{className:"w-full flex flex-row",children:[e.isLoading===!0&&d("div",{className:"fixed w-screen min-h-screen top-0 left-0 flex items-center justify-center z-50  h-full",style:{backgroundColor:"rgba(0,0,0,0.75)"},children:d(Xt,{})}),d("div",{className:"z-10 w-9/12 bg-indigo-200 min-h-full h-screen",children:d(Yt,{})}),d("div",{className:"z-10 w-3/12",children:d(Qt,{})})]})}function ee({children:e}){return d(Ut,{children:e})}const ne="modulepreload",Nt={},re="/",se=function(t,n){return!n||n.length===0?t():Promise.all(n.map(r=>{if(r=`${re}${r}`,r in Nt)return;Nt[r]=!0;const s=r.endsWith(".css"),a=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${a}`))return;const i=document.createElement("link");if(i.rel=s?"stylesheet":ne,s||(i.as="script",i.crossOrigin=""),i.href=r,document.head.appendChild(i),s)return new Promise((o,x)=>{i.addEventListener("load",o),i.addEventListener("error",x)})})).then(()=>t())},ie=e=>{e&&e instanceof Function&&se(()=>import("./web-vitals.d62816c8.js"),[]).then(({getCLS:t,getFID:n,getFCP:r,getLCP:s,getTTFB:a})=>{t(e),n(e),r(e),s(e),a(e)})};Gt.render(d(rt.StrictMode,{children:d(ee,{children:d(te,{})})}),document.getElementById("root"));ie();
