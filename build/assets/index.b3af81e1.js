var bt=Object.defineProperty,kt=Object.defineProperties;var Dt=Object.getOwnPropertyDescriptors;var it=Object.getOwnPropertySymbols;var It=Object.prototype.hasOwnProperty,Tt=Object.prototype.propertyIsEnumerable;var Q=(n,t,e)=>t in n?bt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,U=(n,t)=>{for(var e in t||(t={}))It.call(t,e)&&Q(n,e,t[e]);if(it)for(var e of it(t))Tt.call(t,e)&&Q(n,e,t[e]);return n},at=(n,t)=>kt(n,Dt(t));var b=(n,t,e)=>(Q(n,typeof t!="symbol"?t+"":t,e),e);import{r as L,R as i,m as ot,l as vt,s as Mt,a as X,d as St,z as Bt,i as Ot,b as Lt,c as $t,h as lt,e as Pt}from"./vendor.43dfd358.js";const Gt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerpolicy&&(c.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?c.credentials="include":s.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(s){if(s.ep)return;s.ep=!0;const c=e(s);fetch(s.href,c)}};Gt();class f{constructor(t,e,r){this.x=t,this.y=e,this.z=r,this.x=t||0,this.y=e||0,this.z=r||0}negative(){return new f(-this.x,-this.y,-this.z)}add(t){return t instanceof f?new f(this.x+t.x,this.y+t.y,this.z+t.z):new f(this.x+t,this.y+t,this.z+t)}subtract(t){return t instanceof f?new f(this.x-t.x,this.y-t.y,this.z-t.z):new f(this.x-t,this.y-t,this.z-t)}multiply(t){return t instanceof f?new f(this.x*t.x,this.y*t.y,this.z*t.z):new f(this.x*t,this.y*t,this.z*t)}divide(t){return t instanceof f?new f(this.x/t.x,this.y/t.y,this.z/t.z):new f(this.x/t,this.y/t,this.z/t)}equals(t){return this.x==t.x&&this.y==t.y&&this.z==t.z}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return new f(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}length(){return Math.sqrt(this.dot(this))}magnitude(){return this.length()}unit(){return this.divide(this.length())}min(){return Math.min(Math.min(this.x,this.y),this.z)}max(){return Math.max(Math.max(this.x,this.y),this.z)}toAngles(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length())}}angleTo(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}toArray(t){return[this.x,this.y,this.z].slice(0,t||3)}toCoord(){return new R(this.x,this.y,this.z)}clone(){return new f(this.x,this.y,this.z)}init(t,e,r){return this.x=t,this.y=e,this.z=r,this}normalize(){return this.unit()}setIndex(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break}}distanceTo(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)+Math.pow(this.z-t.z,2))}static negative(t,e,r){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e}static add(t,e,r){return e instanceof f?(r.x=t.x+e.x,r.y=t.y+e.y,r.z=t.z+e.z):(r.x=t.x+e,r.y=t.y+e,r.z=t.z+e),r}static subtract(t,e,r){return e instanceof f?(r.x=t.x-e.x,r.y=t.y-e.y,r.z=t.z-e.z):(r.x=t.x-e,r.y=t.y-e,r.z=t.z-e),r}static multiply(t,e,r){return e instanceof f?(r.x=t.x*e.x,r.y=t.y*e.y,r.z=t.z*e.z):(r.x=t.x*e,r.y=t.y*e,r.z=t.z*e),r}static divide(t,e,r){return e instanceof f?(r.x=t.x/e.x,r.y=t.y/e.y,r.z=t.z/e.z):(r.x=t.x/e,r.y=t.y/e,r.z=t.z/e),r}static cross(t,e,r){return r.x=t.y*e.z-t.z*e.y,r.y=t.z*e.x-t.x*e.z,r.z=t.x*e.y-t.y*e.x,r}static unit(t,e,r){var s=t.length();return e.x=t.x/s,e.y=t.y/s,e.z=t.z/s,e}static fromAngles(t,e){return new f(Math.cos(t)*Math.cos(e),Math.sin(e),Math.sin(t)*Math.cos(e))}static randomDirection(){return f.fromAngles(Math.random()*Math.PI*2,Math.asin(Math.random()*2-1))}static min(t,e,r){return new f(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.min(t.z,e.z))}static max(t,e,r){return new f(Math.max(t.x,e.x),Math.max(t.y,e.y),Math.max(t.z,e.z))}static lerp(t,e,r){return e.subtract(t).multiply(r).add(t)}static fromArray(t){return new f(t[0],t[1],t[2])}static angleBetween(t,e,r){return t.angleTo(e)}static infinity(){return new f(1/0,1/0,1/0)}}class R{constructor(t,e,r){this.x=t,this.y=e,this.z=r}toVec(){return f.fromArray(this.toArray())}toArray(){return[this.x,this.y,this.z]}}var ct;(function(n){n.A="\u03B1",n.B="\u03B2",n.G="\u03B3",n.D="\u03B4",n.E="\u03B5",n.Z="\u03B6",n.H="\u03B7"})(ct||(ct={}));class jt{constructor(){b(this,"center");b(this,"interactions");b(this,"atoms");b(this,"v");b(this,"o");b(this,"hash");b(this,"name");b(this,"sequenceNumber");b(this,"polymerChainIdentifier");this.atoms=[],this.name="",this.sequenceNumber=-1,this.center=new R(-1,-1,-1),this.hash="",this.interactions=[],this.polymerChainIdentifier="",this.v=f.infinity(),this.o=f.infinity()}findAtomsByNames(t){let e=[];return this.atoms.forEach(r=>{t.indexOf(r.name)!==-1&&e.push(r)}),e.sort((r,s)=>t.indexOf(r.name)-t.indexOf(s.name)),e}}var E;(function(n){n.DA="DA",n.DG="DG",n.DC="DC",n.DT="DT"})(E||(E={}));var w;(function(n){n.A="A",n.C="C",n.G="G",n.I="I",n.U="U"})(w||(w={}));var ht;(function(n){n[n.Ala=0]="Ala",n[n.Arg=1]="Arg",n[n.Asn=2]="Asn",n[n.Asp=3]="Asp",n[n.Cys=4]="Cys",n[n.Glu=5]="Glu",n[n.Gln=6]="Gln",n[n.Gly=7]="Gly",n[n.His=8]="His",n[n.Ile=9]="Ile",n[n.Leu=10]="Leu",n[n.Lys=11]="Lys",n[n.Met=12]="Met",n[n.Phe=13]="Phe",n[n.Pro=14]="Pro",n[n.Ser=15]="Ser",n[n.Thr=16]="Thr",n[n.Trp=17]="Trp",n[n.Tyr=18]="Tyr",n[n.Val=19]="Val"})(ht||(ht={}));var k;(function(n){n.DNA="DNA",n.RNA="RNA",n.Protein="Protein",n.Unknown="Unknown"})(k||(k={}));function Ft(n){switch(!0){case n.residueName in E:return k.DNA;case n.residueName in w:return k.RNA;default:return k.Protein}}const tt={polymers:[],pdb:void 0,isLoading:!1,simpleStuffy:"",hashedNucleicAcidResidues:{},viz:{chain1:null,chain2:null},currentPDBId:"",selectedResidue:void 0,error:""},_=L.exports.createContext([tt,()=>{}]),Wt=(n,{type:t,payload:e})=>{switch(t){case"resetState":return U({},tt);default:if(t in n)n[t]=e;else throw new Error(`${t} not found in state`)}return U({},n)},qt=({children:n})=>{const[t,e]=L.exports.useReducer(Wt,tt);return i.createElement(_.Provider,{value:[t,e]},n)};function ut(n){return n.residues.forEach((t,e)=>{const r=new R(0,0,0);t.atoms.forEach(s=>{r.x+=s.coords.x,r.y+=s.coords.y,r.z+=s.coords.z}),r.x=r.x/t.atoms.length,r.y=r.y/t.atoms.length,r.z=r.z/t.atoms.length,n.residues[e].center=r}),n}function dt(n,t){return Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2)+Math.pow(n.z-t.z,2))}function Ht(n){const{sequenceNumber:t,hash:e,name:r,polymerChainIdentifier:s}=n;return{sequenceNumber:t,hash:e,name:r,polymerChainIdentifier:s}}const ft=5;var et;(function(n){n[n.Threshold=0]="Threshold",n[n.HBond=1]="HBond"})(et||(et={}));const Kt=1.42,mt=n=>{if([k.DNA,k.RNA].indexOf(n.kind)!=-1){let t=["C2","C4","C6"];n.residues.forEach(e=>{let r=[];if(e.findAtomsByNames(t).forEach((c,a)=>{r[a]=c.coords}),r.length===3){const c=f.fromArray(r[0].toArray()),a=f.fromArray(r[1].toArray()),l=f.fromArray(r[2].toArray()),p=a.subtract(c).cross(l.subtract(c)).normalize(),A=c.add(a).add(l).divide(3);e.v=p,e.o=A}})}return n};function yt(n,t){const e=[[E.DA,E.DT],[E.DA,w.U],[E.DT,w.A],[E.DC,E.DG],[E.DC,w.G],[E.DG,E.DC],[E.DG,w.C],[w.C,w.G],[w.A,w.U]];for(let r=0;r<e.length;r++)if(n.name===e[r][0]&&t.name===e[r][1]||n.name===e[r][1]&&t.name===e[r][0])return!0;return!1}class Ut{constructor(t){b(this,"nucleicAcids",[]);b(this,"proteins",[]);b(this,"hasValidDNA",!1);b(this,"hasValidRNA",!1);b(this,"visualization",{chain1:null,chain2:null});this.polymers=t,this.prepareObjects()}generateWatsonCrickPairs(t,e){let r=this.calculateWatsonCrickPairs(t,e),s=this.calculateWatsonCrickPairs(e,t);s.reverse();let c=r;return s.forEach(a=>{if(a.length===1)c.push(a);else if(a.length===2){let l=!1;for(let p=0;p<r.length;p++){let A=r[p];if(A.length===2&&A[0].hash===a[1].hash&&A[1].hash===a[0].hash){l=!0;break}}l||console.log(`watsonCrickPairs: matching pair was not found ${a[1].polymerChainIdentifier}:${a[1].sequenceNumber}${a[1].name}---${a[0].polymerChainIdentifier}:${a[0].sequenceNumber}${a[0].name}`,a)}}),c}watsonCrickPairs(){if(this.nucleicAcids.length<=0)throw Error("Nucleic acids are not initialized");let t=[];for(let e=0;e<this.nucleicAcids.length;e++){for(let r=e+1;r<this.nucleicAcids.length;r++){const s=this.generateWatsonCrickPairs(this.nucleicAcids[e],this.nucleicAcids[r]);t.push(...s)}if(this.nucleicAcids[e].kind===k.RNA){const r=this.generateWatsonCrickPairs(this.nucleicAcids[e],this.nucleicAcids[e]);console.log("SIMILAR PAIRS",r),t.push(...r)}}return t}calculateWatsonCrickPairs(t,e){let r=[];return t.residues.forEach(s=>{let c=1/0,a;if(e.residues.forEach(l=>{const p=s.findAtomsByNames(["C2","C4","C6"]),A=[Math.abs(p[0].coords.toVec().subtract(l.o).dot(l.v)),Math.abs(p[1].coords.toVec().subtract(l.o).dot(l.v)),Math.abs(p[2].coords.toVec().subtract(l.o).dot(l.v))],g=l.findAtomsByNames(["C2","C4","C6"]),x=[Math.abs(g[0].coords.toVec().subtract(s.o).dot(s.v)),Math.abs(g[1].coords.toVec().subtract(s.o).dot(s.v)),Math.abs(g[2].coords.toVec().subtract(s.o).dot(s.v))],N=Math.max(...x,...A);N<c&&s.hash!==l.hash&&(c=N,a=l)}),a!==void 0&&c<=Kt+Math.random()&&yt(a,s)&&s.center.toVec().distanceTo(a.center.toVec())<15){r.push([s,a]);const l=a;console.log("Smallest distance: ",`${t.kind}-${s.polymerChainIdentifier}:${s.sequenceNumber}${s.name}`,`${e.kind}-${l.polymerChainIdentifier}:${l.sequenceNumber}${l.name}`,c,yt(a,s))}else r.push([s]),console.log(`No pair for: ${t.kind} ${s.polymerChainIdentifier}:${s.sequenceNumber}${s.name}, smallest distance: ${c}`,a)}),r}prepareObjects(){this.nucleicAcids=this.findNucleicAcids(),this.proteins=this.findProteins(),this.nucleicAcids.forEach(t=>ut(t)),this.proteins.forEach(t=>ut(t))}findProteins(){return this.polymers.filter(t=>[k.Protein].indexOf(t.kind)!==-1)}findNucleicAcids(){return this.polymers.filter(t=>[k.DNA,k.RNA].indexOf(t.kind)!==-1)}thresholdInteractions(){this.nucleicAcids.forEach((t,e)=>{t.residues.forEach((r,s)=>{this.proteins.forEach(c=>{c.residues.forEach(a=>{dt(r.center,a.center)<=ft*2&&r.atoms.forEach(p=>{a.atoms.forEach(A=>{const g=dt(p.coords,A.coords);g<=ft&&this.nucleicAcids[e].residues[s].interactions.push({residue:Ht(a),type:et.Threshold,polymerKind:c.kind,meta:{distance:g}})})})})})})})}}var G;(function(n){n.Pair="pair",n.Backbone="backbone"})(G||(G={}));const Z={size:10,y:4};function Rt({nodes:n,links:t,svgRef:e,dispatch:r},s){let{nodeId:c=h=>h.id,nodeGroups:a,nodeTitle:l,nodeFill:p=h=>h.color!==void 0?h.color:"currentColor",nodeStroke:A="#fff",nodeStrokeWidth:g=1.5,nodeStrokeOpacity:x=1,nodeRadius:N=10,nodeStrength:M,linkStroke:o=h=>h.color!==void 0?h.color:"#444",linkStrokeOpacity:u=.6,linkStrokeWidth:y=1.5,linkStrokeLinecap:d="round",linkStrength:m=2,width:C=640,height:O=400,invalidation:z}=s;const T=n,S=t,P=ot(n,c).map(At);l===void 0&&(l=(h,B)=>P[B]);const F=typeof y!="function"?null:ot(t,y);n=T,t=S;const D=Lt(),v=vt(t).id(({index:h})=>P[h]).distance((h,B)=>S[B].linkType===G.Backbone?5:70).strength((h,B)=>S[B].linkType===G.Backbone?5e3:1);M!==void 0&&D.strength(M),m!==void 0&&v.strength(m);const W=Mt(n).force("link",v).force("charge",D).on("tick",wt),q=X(e).attr("width",C).attr("height",O).attr("viewBox",[-C/2,-O/2,C,O]).attr("style","max-width: 100%; height: auto; height: intrinsic;");q.html("");const H=q.append("g"),nt=H.append("g").attr("stroke-opacity",u).attr("stroke-width",typeof y!="function"?y:null).attr("stroke-linecap",d).selectAll("line").data(t).join("line").attr("stroke-dasharray",h=>h.linkType==="pair"?"4":null).attr("stroke",o),K=H.append("g").selectAll("g").data(n).enter().append("g").call(zt(W)),gt=K.append("circle").attr("stroke",A).attr("stroke-opacity",x).attr("stroke-width",g).attr("fill",p).attr("r",N);let V=new Date;K.on("mouseover",function(h,B){X(this).select("circle").attr("r",rt(N*2)),new Date().getTime()-V.getTime()>250&&(r({type:"selectedResidue",payload:B}),V=new Date)}).on("mouseout",function(h,B){X(this).select("circle").attr("r",rt(N)),new Date().getTime()-V.getTime()>50&&r({type:"selectedResidue",payload:void 0})});const Et=K.append("text").text(h=>h.name).attr("text-anchor","middle").attr("font-size",Z.size).attr("y",Z.y).attr("class","svg-graph-text");F&&nt.attr("stroke-width",h=>F[h.index]),z!=null&&z.then(()=>W.stop());function At(h){return h!==null&&typeof h=="object"?h.valueOf():h}function wt(){nt.attr("x1",h=>h.source.x).attr("y1",h=>h.source.y).attr("x2",h=>h.target.x).attr("y2",h=>h.target.y),K.attr("transform",h=>`translate(${h.x}, ${h.y})`)}function zt(h){function B(I){I.active||h.alphaTarget(.3).restart(),I.subject.fx=I.subject.x,I.subject.fy=I.subject.y}function Nt(I){I.subject.fx=I.x,I.subject.fy=I.y}function Ct(I){I.active||h.alphaTarget(0),I.subject.fx=null,I.subject.fy=null}return St().on("start",B).on("drag",Nt).on("end",Ct)}const rt=h=>$?h/$:h;let J,$;const st=Bt().on("zoom",h=>{H.attr("transform",J=h.transform),J&&($=Math.sqrt(J.k),H.style("stroke-width",3/$),gt.attr("r",N/$).attr("stroke-width",g/$),Et.attr("font-size",Z.size/$).attr("y",Z.y/$))});return q.call(st).call(st.transform,Ot),Object.assign(q.node(),{scales:{color:null}})}const _t={[E.DA]:"#fcb331",[E.DT]:"#5670fb",[E.DG]:"#f63c37",[E.DC]:"#03c907",[w.A]:"#acb331",[w.U]:"#a670fb",[w.G]:"#a63c37",[w.C]:"#a3c907",[w.I]:"#a3c907"},Y="red",j="blue",Zt={[E.DA]:Y,[E.DT]:Y,[E.DG]:j,[E.DC]:j,[w.A]:Y,[w.U]:Y,[w.G]:j,[w.C]:j,[w.I]:j},Yt="#494949";function Vt(){const[n,t]=L.exports.useContext(_),e=n.polymers;let r=i.createRef(),s=i.createRef(),c=L.exports.useRef(null);function a(){if(!r||e.length<=0)return;console.time("Nucleic_acid_VIZ");const l=new Ut(e);let p;try{p=l.watsonCrickPairs()}catch(u){console.log(u),t({type:"error",payload:u.toString()});return}let A=[],g=[];const x=u=>`${u.polymerChainIdentifier}:${u.name}${u.sequenceNumber}`,N=u=>{const y=Object.values(E);u.residues.forEach((d,m)=>{A.push(at(U({},d),{hash:d.hash,name:d.name.toString().slice(-1),id:x(d),color:_t[d.name],group:y.indexOf(d.name)+1}));let C=u.residues;m>0&&m<C.length&&g.push({source:x(C[m-1]),target:x(d),value:1,color:Yt,linkType:G.Backbone})})};l.nucleicAcids.forEach(u=>N(u)),p.forEach(u=>{const y=u[0];if(u.length===2){const d=u[1];g.push({source:x(d),target:x(y),value:1,color:Zt[y.name],linkType:G.Pair})}}),console.log("Vizualization data:",A,g);let[M,o]=[c.current.offsetWidth,c.current.offsetHeight];Rt({nodes:A,links:g,svgRef:r.current,dispatch:t},{width:M,height:o}),console.timeEnd("Nucleic_acid_VIZ")}return L.exports.useEffect(a,[e]),i.createElement(i.Fragment,null,i.createElement("div",null,n.simpleStuffy),i.createElement("div",{className:"p-5 flex items-center flex-col h-full",ref:c},i.createElement("div",{className:"min-w-full h-full relative"},i.createElement("svg",{ref:r})),i.createElement("div",{ref:s,style:{position:"absolute",opacity:0,background:"#fff"}})))}class pt{constructor(t){b(this,"file");t!==void 0&&(this.file=t)}async readData(){if(this.file==null)throw Error("file not provided");let t=await this.file.text();return this.format(t)}format(t){return{raw:this.formatText(t),polymers:this.formatPolymers(t)}}formatText(t){return t.split(`
`).map((e,r)=>r.toString()+". "+e).join(`
`)}formatPolymers(t){let e=[];const r=()=>({chainIdentifier:"",residues:[],kind:k.Unknown}),s=()=>new jt,c=()=>{l.hash=lt(l),a.residues.push(l)};let a=r(),l=s();const p=o=>{let u={[k.DNA]:0,[k.RNA]:0,[k.Protein]:0};return o===void 0?u:[u,Object.keys(o).reduce((y,d)=>o[y]>o[d]?y:d)]};let A=p(),g=[],x,N=!1;const M=()=>{x={chains:[],rotations:[],translations:[f.infinity()]}};return t.split(`
`).forEach(o=>{if(o.startsWith("ATOM")||o.startsWith("HETATM")){let u=parseFloat(o.slice(30,38).trim()),y=parseFloat(o.slice(38,46).trim()),d=parseFloat(o.slice(46,54).trim()),m=o.slice(12,16).trim(),C=o.slice(17,20).trim(),O=o.slice(76,78).trim(),z=parseInt(o.slice(22,26).trim()),T=o.slice(21,22);a.chainIdentifier=T;const S={coords:new R(u,y,d),name:m,element:O,residueName:C,residueSequenceNumber:z};A[Ft(S)]++,l.sequenceNumber===-1&&(l.name=S.residueName,l.sequenceNumber=z,l.polymerChainIdentifier=T),z!==l.sequenceNumber&&(c(),l=s(),l.name=S.residueName,l.sequenceNumber=z,l.polymerChainIdentifier=T),l.atoms.push(S)}if(o.startsWith("TER")){c();let[u,y]=p(A);A=u,a.kind=y,a=mt(a),e.push(a),a=r(),l=s()}if(o.startsWith("REMARK 350")){if(N=!0,["REMARK 350 APPLY THE FOLLOWING TO CHAINS: ","REMARK 350                    AND CHAINS:"].forEach((y,d)=>{if(o.startsWith(y)){let m=o.trim().slice(y.length-1,o.length).toString().replaceAll(" ","").split(",");d===0&&(M(),x.chains.length>0&&g.push(x)),m.length>0&&x.chains.push(...m)}}),o.startsWith("REMARK 350   BIOMT")){let d=o.replace("REMARK 350   BIOMT","").match(new RegExp(/(\d{1})\s*(\d{1})\s*([+-]?[0-9]*[.]?[0-9]+)\s*([+-]?[0-9]*[.]?[0-9]+)\s*([+-]?[0-9]*[.]?[0-9]+)\s*([+-]?[0-9]*[.]?[0-9]+)/));if(d!=null&&d.length===6+1){d=d.slice(1);let m=parseInt(d[1])-1,C=parseInt(d[0])-1,O=[parseFloat(d[2]),parseFloat(d[3]),parseFloat(d[4])],z=parseFloat(d[5]);typeof x.translations[m]=="undefined"&&(x.translations[m]=f.infinity()),x.translations[m].setIndex(C,z),Array.isArray(x.rotations[m])||(x.rotations[m]=[]),x.rotations[m][C]=O}}}else N&&(g.push(x),M()),N=!1}),g.forEach(o=>{const u=e.filter(m=>o.chains.indexOf(m.chainIdentifier)!==-1),y=o.rotations.slice(1),d=o.translations.slice(1);y.forEach((m,C)=>{u.forEach(O=>{let z=$t(O,{includeNonEnumerable:!0});z.chainIdentifier=z.chainIdentifier+(C+1).toString(),z.generatedFromTransform=!0,z.residues.forEach((T,S)=>{T.polymerChainIdentifier=z.chainIdentifier,T.atoms.forEach((P,F)=>{let D=P.coords.toVec(),v=f.infinity();console.log("Coorinates before:",D),v.x=D.x*m[0][0]+D.y*m[0][1]+D.z*m[0][2],v.y=D.x*m[1][0]+D.y*m[1][1]+D.z*m[1][2],v.z=D.x*m[2][0]+D.y*m[2][1]+D.z*m[2][2];const W=d[C];v=v.add(W),console.log("Coords after:",v),console.log("Distance between atoms: ",v.distanceTo(D)),P.coords=v.toCoord(),T.atoms[F]=P}),T.hash=lt(T),z.residues[S]=T}),z=mt(z),e.push(z)})})}),console.log("Transformations:",g),console.log("Result after translation",e),e}}const Jt=async n=>await(await fetch(`https://files.rcsb.org/download/${n}.pdb`)).text();function Qt(){var M;const[n,t]=L.exports.useContext(_),e=()=>{t({type:"isLoading",payload:!0})},r=()=>{t({type:"isLoading",payload:!1})},s=o=>{t({type:"pdb",payload:o})},c=o=>{t({type:"currentPDBId",payload:o})},a=o=>{t({type:"polymers",payload:o})},l=()=>{t({type:"resetState",payload:null})},p=async o=>{l(),e();const u=new pt().format(await Jt(o));s(u),a(u.polymers),c(o),r()};L.exports.useEffect(()=>{const u=new URLSearchParams(window.location.search).get("id");console.log("ID",u),u!==null&&p(u)},[]);const A=async o=>{var y;let u=(y=o.target.files)==null?void 0:y.item(0);if(u!==null){l(),e(),console.time("TIME_TO_PARSE_EVERYTHING"),console.time("TIME_TO_PARSE_PDB");const d=await new pt(u).readData();console.timeEnd("TIME_TO_PARSE_PDB"),s(d),a(d.polymers),console.timeEnd("TIME_TO_PARSE_EVERYTHING"),setTimeout(r,2e3)}};let g;n.polymers.length>0&&(g=i.createElement("div",{className:"mt-5"},i.createElement("div",{className:"mb-1"},"Provided input file"),i.createElement("textarea",{className:"text-sm w-full border h-96 border-blue-100",value:(M=n.pdb)==null?void 0:M.raw,readOnly:!0})));const x=L.exports.useRef(null),N=()=>{var u;const o=(u=x.current)==null?void 0:u.value;o&&p(o)};return i.createElement("div",{className:"p-5 max-h-screen overflow-auto break-words"},!n.isLoading&&i.createElement("div",null,n.error.length>0&&i.createElement("div",{className:"mb-4"},i.createElement("div",{className:"text-red-700 font-bold text-lg"},"Something went wrong: ",n.error)),n.pdb===void 0&&i.createElement("div",{className:"text-sm text-gray-600 mb-4 bg-red-200 p-2"},"Choose a PDB file which contains DNA/RNA with Proteins"),i.createElement("div",null,n.currentPDBId.length>0&&i.createElement("div",{className:"mb-4"},"Currently selected PDB ID:",i.createElement("b",null,n.currentPDBId.toUpperCase())),i.createElement("div",{className:"mb-4"},i.createElement("div",{className:"text-normal font-bold text-gray-600 mb-2"},"Enter PDB file ID:",i.createElement("div",{className:"text-xs font-normal"},"PDB file should contain ",i.createElement("b",null,"DNA/RNA")," structures")),i.createElement("div",{className:"flex flex-row max-w-full"},i.createElement("input",{onKeyPress:o=>{o.key==="Enter"&&N()},ref:x,placeholder:"1ZS4",className:"border-r-0 outline-none ring-indigo-200 focus:ring-2 transition-all block py-1 px-2 outline-0 border border-indigo-300 rounded rounded-tr-none rounded-br-none"}),i.createElement("button",{onClick:N,className:"bg-indigo-400 border-l-0 text-white font-bold text-sm ring-indigo-200 focus:ring-2 hover:bg-indigo-600 transition-all w-[100px]  block rounded rounded-tl-none rounded-bl-none border border-indigo-300"},"GO"))),i.createElement("div",{className:"text-normal font-bold text-gray-600 mb-2"},"Or choose a PDB file to display:",i.createElement("div",{className:"text-xs font-normal"},"PDB file should contain ",i.createElement("b",null,"DNA/RNA")," structures")),i.createElement("input",{type:"file",onChange:A,className:"max-w-full"}))),g,n.pdb&&i.createElement("div",null,"Polymers from input:",n.polymers.map(({residues:o,chainIdentifier:u,kind:y},d)=>i.createElement("div",{className:"ml-2",key:d},"Chain:"," ",i.createElement("b",null,u," (",y,")"),i.createElement("div",{className:"ml-2"},o.map((m,C)=>i.createElement("span",{key:C},m.name," \xA0")))))))}const Xt=()=>i.createElement("div",{className:"flex flex-col items-center gap-1"},i.createElement("div",{className:"text-white font-bold"},"Loading"),i.createElement("div",{className:"lds-roller"},i.createElement("div",null),i.createElement("div",null),i.createElement("div",null),i.createElement("div",null),i.createElement("div",null),i.createElement("div",null),i.createElement("div",null),i.createElement("div",null)));function te(){const n=L.exports.useContext(_)[0];return i.createElement("div",{className:"w-full flex flex-row"},n.isLoading===!0&&i.createElement("div",{className:"fixed w-screen min-h-screen top-0 left-0 flex items-center justify-center z-50  h-full",style:{backgroundColor:"rgba(0,0,0,0.75)"}},i.createElement(Xt,null)),i.createElement("div",{className:"z-10 w-9/12 bg-indigo-200 min-h-full h-screen"},i.createElement(Vt,null)),i.createElement("div",{className:"z-10 w-3/12"},i.createElement(Qt,null)))}function ee({children:n}){return i.createElement(qt,null,n)}const ne="modulepreload",xt={},re="/",se=function(t,e){return!e||e.length===0?t():Promise.all(e.map(r=>{if(r=`${re}${r}`,r in xt)return;xt[r]=!0;const s=r.endsWith(".css"),c=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${c}`))return;const a=document.createElement("link");if(a.rel=s?"stylesheet":ne,s||(a.as="script",a.crossOrigin=""),a.href=r,document.head.appendChild(a),s)return new Promise((l,p)=>{a.addEventListener("load",l),a.addEventListener("error",p)})})).then(()=>t())},ie=n=>{n&&n instanceof Function&&se(()=>import("./web-vitals.d62816c8.js"),[]).then(({getCLS:t,getFID:e,getFCP:r,getLCP:s,getTTFB:c})=>{t(n),e(n),r(n),s(n),c(n)})};Pt.render(i.createElement(i.StrictMode,null,i.createElement(ee,null,i.createElement(te,null))),document.getElementById("root"));ie();
