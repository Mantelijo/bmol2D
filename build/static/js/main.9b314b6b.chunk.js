(this.webpackJsonpbmol2d=this.webpackJsonpbmol2d||[]).push([[0],{65:function(e,n,t){},68:function(e,n,t){},69:function(e,n,t){"use strict";t.r(n);var i,r,a,s,c,o=t(2),u=t.n(o),l=t(25),d=t.n(l),h=(t(65),t(1)),f=t.n(h),m=t(5),p=t(3),v=t(28),b=t(4),j=t(6);!function(e){e.A="\u03b1",e.B="\u03b2",e.G="\u03b3",e.D="\u03b4",e.E="\u03b5",e.Z="\u03b6",e.H="\u03b7"}(i||(i={})),function(e){e.DA="DA",e.DG="DG",e.DC="DC",e.DT="DT"}(r||(r={})),function(e){e[e.A=0]="A",e[e.C=1]="C",e[e.G=2]="G",e[e.I=3]="I",e[e.U=4]="U"}(a||(a={})),function(e){e[e.Ala=0]="Ala",e[e.Arg=1]="Arg",e[e.Asn=2]="Asn",e[e.Asp=3]="Asp",e[e.Cys=4]="Cys",e[e.Glu=5]="Glu",e[e.Gln=6]="Gln",e[e.Gly=7]="Gly",e[e.His=8]="His",e[e.Ile=9]="Ile",e[e.Leu=10]="Leu",e[e.Lys=11]="Lys",e[e.Met=12]="Met",e[e.Phe=13]="Phe",e[e.Pro=14]="Pro",e[e.Ser=15]="Ser",e[e.Thr=16]="Thr",e[e.Trp=17]="Trp",e[e.Tyr=18]="Tyr",e[e.Val=19]="Val"}(s||(s={})),function(e){e.DNA="DNA",e.RNA="RNA",e.Protein="Protein",e.Unknown="Unknown"}(c||(c={}));var x=t(26),y=t(0),O={polymers:[],pdb:void 0,isLoading:!1,simpleStuffy:"",hashedNucleicAcidResidues:{},viz:{chain1:null,chain2:null}},g=Object(o.createContext)([O,function(){}]),A=function(e,n){var t=n.type,i=n.payload;if(!(t in e))throw new Error("".concat(t," not found in state"));return e[t]=i,Object(x.a)({},e)},N=function(e){var n=e.children,t=Object(o.useReducer)(A,O),i=Object(b.a)(t,2),r=i[0],a=i[1];return Object(y.jsx)(g.Provider,{value:[r,a],children:n})},w=t(15),E=t(16);function k(e){return e.residues.forEach((function(n,t){var i={x:0,y:0,z:0};n.atoms.forEach((function(e){i.x+=e.coords.x,i.y+=e.coords.y,i.z+=e.coords.z})),i.x=i.x/n.atoms.length,i.y=i.y/n.atoms.length,i.z=i.z/n.atoms.length,e.residues[t].center=i})),e}function D(e,n){return Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2)+Math.pow(e.z-n.z,2))}function z(e){return{sequenceNumber:e.sequenceNumber,hash:e.hash,name:e.name,polymerChainIdentifier:e.polymerChainIdentifier}}function I(e,n){return e.name===r[r.DA]&&n.name===r[r.DT]||e.name===r[r.DT]&&n.name===r[r.DA]||e.name===r[r.DC]&&n.name===r[r.DG]||e.name===r[r.DG]&&n.name===r[r.DC]}var T;!function(e){e[e.Threshold=0]="Threshold",e[e.HBond=1]="HBond"}(T||(T={}));var C=function(){function e(n,t){Object(w.a)(this,e),this.polymers=n,this.dispatch=t,this.nucleicAcids=[],this.proteins=[],this.visualization={chain1:null,chain2:null},this.prepareObjects()}return Object(E.a)(e,[{key:"prepareObjects",value:function(){this.nucleicAcids=this.findNucleoAcids(),this.proteins=this.findProteins(),this.nucleicAcids.forEach((function(e){return k(e)})),this.proteins.forEach((function(e){return k(e)}))}},{key:"findProteins",value:function(){return this.polymers.filter((function(e){return-1!==[c.Protein].indexOf(e.kind)}))}},{key:"findNucleoAcids",value:function(){return this.polymers.filter((function(e){return-1!==[c.DNA,c.RNA].indexOf(e.kind)}))}},{key:"generateVisualizationScaffold",value:function(){if(this.nucleicAcids.length<=0)throw Error("Nucleic acids are not initialized");if(this.nucleicAcids.length>=2&&this.nucleicAcids[0].kind===c.DNA){this.visualization.chain1=[],this.visualization.chain2=[];var e=this.nucleicAcids[0],n=this.nucleicAcids[1],t=new Array(e.residues.length).fill(1/0);e.residues.forEach((function(e,i){n.residues.forEach((function(n,i){I(e,n)&&(t[i]=Math.min(t[i],D(e.center,n.center)))}))}));for(var i=0,r=0,a=0;a<e.residues.length;a++){for(var s=e.residues[a],o=n.residues.length-1-r;o>0;--o){var u=n.residues[o];if(!I(s,u)&&o-1>0&&0===a){var l=n.residues[o-1];I(s,l)?(this.visualization.chain2.push({index:i,residue:z(l),interactions:l.interactions}),r++):this.visualization.chain1.push({index:i,residue:z(s),interactions:s.interactions}),i++;break}if(I(s,u)){this.visualization.chain1.push({index:i,residue:z(s),interactions:s.interactions}),r<=n.residues.length&&(this.visualization.chain2.push({index:i,residue:z(u),interactions:u.interactions}),r++),i++;break}}if(r>n.residues.length){this.visualization.chain1.push({index:i,residue:z(s),interactions:s.interactions}),i++;break}}if(console.log("secondChainIncludedAmount",r,n.residues.length),r<n.residues.length)for(var d=n.residues.length-r-1;d>=0;--d)this.visualization.chain2.push({index:i,residue:z(n.residues[d]),interactions:n.residues[d].interactions}),i++,r++}else this.visualization.chain1=[],this.visualization.chain2=null;return this.visualization}},{key:"thresholdInteractions",value:function(){var e=this;this.nucleicAcids.forEach((function(n,t){n.residues.forEach((function(n,i){e.proteins.forEach((function(r){r.residues.forEach((function(a){D(n.center,a.center)<=10&&n.atoms.forEach((function(n){a.atoms.forEach((function(s){var c=D(n.coords,s.coords);c<=5&&e.nucleicAcids[t].residues[i].interactions.push({residue:z(a),type:T.Threshold,polymerKind:r.kind,meta:{distance:c}})}))}))}))}))}))}))}}]),e}();function P(){var e=Object(o.useContext)(g),n=Object(b.a)(e,2),t=n[0],i=n[1],a=t.polymers,s=u.a.createRef(),l=u.a.createRef(),d=[];return a.filter((function(e){return-1!==[c.DNA,c.RNA].indexOf(e.kind)})).map((function(e){e.residues.map((function(e){return d.push.apply(d,Object(v.a)(e.atoms))}))})),Object(o.useEffect)((function(){var e;if(s&&!(a.length<=0)){var n=(e={},Object(p.a)(e,r.DA,"#00897b"),Object(p.a)(e,r.DT,"#c2185b"),Object(p.a)(e,r.DG,"#3949ab"),Object(p.a)(e,r.DC,"#ffa000"),e),t=function(e){return e.name in r?n[e.name]:"#95fe44"};j.b(s.current).selectAll("*").remove();var c=new C(a,i).generateVisualizationScaffold(),o=[];if(null!==c.chain1){null===c||void 0===c||c.chain1.forEach((function(e){o.push({x:0,y:e.index,data:e.residue,chainId:e.residue.polymerChainIdentifier,visualizationResidue:e})})),null!==c.chain2&&c.chain2.forEach((function(e){o.push({x:1,y:e.index,data:e.residue,chainId:e.residue.polymerChainIdentifier,visualizationResidue:e})}));var u=Math.max(c.chain1.length,null!==c.chain2?c.chain2.length:0),d=null!==c.chain2?2:1,h=j.a().domain([0,u]).range([40,460]),v=j.a().domain([0,d]).range([200,700]),b=j.b(l.current),x=s.current;j.b(x).attr("width",900).attr("height",500).selectAll().data(o).enter().append("circle").attr("cx",(function(e){return v(e.x)})).attr("cy",(function(e){return h(e.y)})).style("fill",(function(e){return t(e.data)})).attr("r",10).on("mouseover",function(){var e=Object(m.a)(f.a.mark((function e(n,t){var i,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j.b(this).attr("r",15).style("fill",(function(){return t.data,"#95fe44"})),i=t.data,e.prev=2,r="<div><b>Interactions</b></div>",t.visualizationResidue.interactions.forEach((function(e){var n;r+="<div>".concat(e.polymerKind,":").concat(e.residue.name+":"+e.residue.sequenceNumber," ").concat(null===(n=e.meta)||void 0===n?void 0:n.distance,"</div>")})),e.next=7,b.html("<div>Residue: ".concat(i.name," seqno: ").concat(i.sequenceNumber," ChainID: ").concat(t.chainId,"</div>").concat(r)).transition().duration(50).style("left",n.pageX+"px").style("top",n.pageY+"px").end();case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.log("Something went wrong: ",e.t0);case 12:b.style("opacity",1);case 13:case"end":return e.stop()}}),e,this,[[2,9]])})));return function(n,t){return e.apply(this,arguments)}}()).on("mouseout",(function(e,n){b.style("opacity",0),j.b(this).attr("r",10).style("fill",(function(){return t(n.data)}))}))}}}),[a]),Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("div",{children:t.simpleStuffy}),Object(y.jsxs)("div",{className:"p-5 flex items-center flex-col",children:[Object(y.jsxs)("div",{children:["Total number of atoms: ",d.length]}),Object(y.jsx)("svg",{ref:s}),Object(y.jsx)("div",{ref:l,style:{position:"absolute",opacity:0,background:"#fff"}})]})]})}var R=t(27),S=t.n(R),G=function(){function e(n){Object(w.a)(this,e),this.file=void 0,void 0!==n&&(this.file=n)}return Object(E.a)(e,[{key:"readData",value:function(){var e=Object(m.a)(f.a.mark((function e(){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!=this.file){e.next=2;break}throw Error("file not provided");case 2:return e.next=4,this.file.text();case 4:return n=e.sent,e.abrupt("return",this.format(n));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"format",value:function(e){return{raw:this.formatText(e),polymers:this.formatPolymers(e)}}},{key:"formatText",value:function(e){return e.split("\n").map((function(e,n){return n.toString()+". "+e})).join("\n")}},{key:"formatPolymers",value:function(e){var n=[],t=function(){return{chainIdentifier:"",residues:[],kind:c.Unknown}},i=function(){o.hash=S()(o),s.residues.push(o)},s=t(),o={atoms:[],name:"",sequenceNumber:-1,center:{x:-1,y:-1,z:-1},hash:"",interactions:[],polymerChainIdentifier:""},u=function(e){var n,t=(n={},Object(p.a)(n,c.DNA,0),Object(p.a)(n,c.RNA,0),Object(p.a)(n,c.Protein,0),n);return void 0===e?t:[t,Object.keys(e).reduce((function(n,t){return e[n]>e[t]?n:t}))]},l=u();return e.split("\n").forEach((function(e){if(e.startsWith("ATOM")){var d=parseFloat(e.slice(30,38).trim()),h=parseFloat(e.slice(38,46).trim()),f=parseFloat(e.slice(46,54).trim()),m=e.slice(12,16).trim(),p=e.slice(17,20).trim(),v=e.slice(76,78).trim(),j=parseInt(e.slice(22,26).trim()),x=e.slice(21,22);s.chainIdentifier=x;var y={coords:{x:d,y:h,z:f},name:m,element:v,residueName:p,residueSequenceNumber:j};l[function(e){switch(!0){case e.residueName in r:return c.DNA;case e.residueName in a:return c.RNA;default:return c.Protein}}(y)]++,-1===o.sequenceNumber&&(o.name=y.residueName,o.sequenceNumber=j,o.polymerChainIdentifier=x),j!==o.sequenceNumber&&(i(),(o={atoms:[],name:"",sequenceNumber:-1,center:{x:-1,y:-1,z:-1},hash:"",interactions:[],polymerChainIdentifier:""}).name=y.residueName,o.sequenceNumber=j,o.polymerChainIdentifier=x),o.atoms.push(y)}if(e.startsWith("TER")){i();var O=u(l),g=Object(b.a)(O,2),A=g[0],N=g[1];l=A,s.kind=N,n.push(s),s=t(),o={atoms:[],name:"",sequenceNumber:-1,center:{x:-1,y:-1,z:-1},hash:"",interactions:[],polymerChainIdentifier:""}}})),n}}]),e}(),q=function(){var e=Object(m.a)(f.a.mark((function e(n){var t,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://files.rcsb.org/download/".concat(n,".pdb"));case 2:return t=e.sent,e.next=5,t.text();case 5:return i=e.sent,e.abrupt("return",i);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();function M(){var e=Object(o.useContext)(g),n=Object(b.a)(e,2),t=n[0],i=n[1],r=function(){i({type:"isLoading",payload:!0})},a=function(){i({type:"isLoading",payload:!1})},s=function(e){i({type:"pdb",payload:e})},c=function(e){i({type:"polymers",payload:e});var n=new C(e,i);n.thresholdInteractions(),i({type:"viz",payload:n.generateVisualizationScaffold()})};Object(o.useEffect)((function(){var e=new URLSearchParams(window.location.search).get("id");console.log("ID",e),null!==e&&Object(m.a)(f.a.mark((function n(){var t;return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r(),n.t0=new G,n.next=4,q(e);case 4:n.t1=n.sent,t=n.t0.format.call(n.t0,n.t1),s(t),c(t.polymers),a();case 9:case"end":return n.stop()}}),n)})))()}),[]);var u,l,d=function(){var e=Object(m.a)(f.a.mark((function e(n){var t,i,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(i=null===(t=n.target.files)||void 0===t?void 0:t.item(0))){e.next=13;break}return r(),console.time("TIME_TO_PARSE_EVERYTHING"),console.time("TIME_TO_PARSE_PDB"),e.next=7,new G(i).readData();case 7:o=e.sent,console.timeEnd("TIME_TO_PARSE_PDB"),s(o),c(o.polymers),console.timeEnd("TIME_TO_PARSE_EVERYTHING"),setTimeout(a,2e3);case 13:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();t.polymers.length>0&&(u=Object(y.jsxs)("div",{className:"mt-5",children:[Object(y.jsx)("div",{className:"mb-1",children:"Provided input file"}),Object(y.jsx)("textarea",{className:"text-sm w-full border h-96 border-blue-100",value:null===(l=t.pdb)||void 0===l?void 0:l.raw,readOnly:!0})]}));return Object(y.jsxs)("div",{className:"p-5 max-h-screen overflow-auto break-words",children:[!t.isLoading&&Object(y.jsxs)("div",{children:[void 0===t.pdb&&Object(y.jsx)("div",{className:"text-sm text-gray-600 mb-4 bg-red-200 p-2",children:"Choose a PDB file which contains DNA/RNA with Proteins"}),Object(y.jsx)("div",{children:Object(y.jsx)("input",{type:"file",onChange:d})})]}),u,t.pdb&&Object(y.jsxs)("div",{children:["Polymers from input:",t.polymers.map((function(e,n){var t=e.residues,i=e.chainIdentifier,r=e.kind;return Object(y.jsxs)("div",{className:"ml-2",children:["Chain: ",Object(y.jsxs)("b",{children:[i," (",r,")"]}),Object(y.jsx)("div",{className:"ml-2",children:t.map((function(e,n){return Object(y.jsxs)("span",{children:[e.name," \xa0"]},n)}))})]},n)}))]})]})}t(68);var L=function(){return Object(y.jsxs)("div",{className:"lds-roller",children:[Object(y.jsx)("div",{}),Object(y.jsx)("div",{}),Object(y.jsx)("div",{}),Object(y.jsx)("div",{}),Object(y.jsx)("div",{}),Object(y.jsx)("div",{}),Object(y.jsx)("div",{}),Object(y.jsx)("div",{})]})};function _(){var e=Object(o.useContext)(g)[0];return Object(y.jsxs)("div",{className:"w-full flex flex-row",children:[!0===e.isLoading&&Object(y.jsx)("div",{className:"fixed w-screen min-h-screen top-0 left-0 flex items-center justify-center z-50",style:{backgroundColor:"rgba(0,0,0,0.35)"},children:Object(y.jsx)(L,{})}),Object(y.jsx)("div",{className:"z-10 w-9/12 bg-indigo-300 min-h-full h-screen",children:Object(y.jsx)(P,{})}),Object(y.jsx)("div",{className:"z-10 w-3/12",children:Object(y.jsx)(M,{})})]})}function B(e){var n=e.children;return Object(y.jsx)(N,{children:n})}var F=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,70)).then((function(n){var t=n.getCLS,i=n.getFID,r=n.getFCP,a=n.getLCP,s=n.getTTFB;t(e),i(e),r(e),a(e),s(e)}))};d.a.render(Object(y.jsx)(u.a.StrictMode,{children:Object(y.jsx)(B,{children:Object(y.jsx)(_,{})})}),document.getElementById("root")),F()}},[[69,1,2]]]);
//# sourceMappingURL=main.9b314b6b.chunk.js.map