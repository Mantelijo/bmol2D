(this.webpackJsonpbmol2d=this.webpackJsonpbmol2d||[]).push([[0],{108:function(e,t,n){},116:function(e,t,n){},117:function(e,t,n){"use strict";n.r(t);var i,r=n(1),a=n.n(r),s=n(29),o=n.n(s),c=(n(108),n(12)),u=n(18),l=n(8),d=n(2),h=n(5),f=n(6),y=function(){function e(t,n,i){Object(h.a)(this,e),this.x=t,this.y=n,this.z=i,this.x=t||0,this.y=n||0,this.z=i||0}return Object(f.a)(e,[{key:"negative",value:function(){return new e(-this.x,-this.y,-this.z)}},{key:"add",value:function(t){return t instanceof e?new e(this.x+t.x,this.y+t.y,this.z+t.z):new e(this.x+t,this.y+t,this.z+t)}},{key:"subtract",value:function(t){return t instanceof e?new e(this.x-t.x,this.y-t.y,this.z-t.z):new e(this.x-t,this.y-t,this.z-t)}},{key:"multiply",value:function(t){return t instanceof e?new e(this.x*t.x,this.y*t.y,this.z*t.z):new e(this.x*t,this.y*t,this.z*t)}},{key:"divide",value:function(t){return t instanceof e?new e(this.x/t.x,this.y/t.y,this.z/t.z):new e(this.x/t,this.y/t,this.z/t)}},{key:"equals",value:function(e){return this.x==e.x&&this.y==e.y&&this.z==e.z}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"cross",value:function(t){return new e(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}},{key:"length",value:function(){return Math.sqrt(this.dot(this))}},{key:"magnitude",value:function(){return this.length()}},{key:"unit",value:function(){return this.divide(this.length())}},{key:"min",value:function(){return Math.min(Math.min(this.x,this.y),this.z)}},{key:"max",value:function(){return Math.max(Math.max(this.x,this.y),this.z)}},{key:"toAngles",value:function(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length())}}},{key:"angleTo",value:function(e){return Math.acos(this.dot(e)/(this.length()*e.length()))}},{key:"toArray",value:function(e){return[this.x,this.y,this.z].slice(0,e||3)}},{key:"toCoord",value:function(){return new m(this.x,this.y,this.z)}},{key:"clone",value:function(){return new e(this.x,this.y,this.z)}},{key:"init",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:"normalize",value:function(){return this.unit()}},{key:"setIndex",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t}}},{key:"distanceTo",value:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)+Math.pow(this.z-e.z,2))}}],[{key:"negative",value:function(e,t,n){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t}},{key:"add",value:function(t,n,i){return n instanceof e?(i.x=t.x+n.x,i.y=t.y+n.y,i.z=t.z+n.z):(i.x=t.x+n,i.y=t.y+n,i.z=t.z+n),i}},{key:"subtract",value:function(t,n,i){return n instanceof e?(i.x=t.x-n.x,i.y=t.y-n.y,i.z=t.z-n.z):(i.x=t.x-n,i.y=t.y-n,i.z=t.z-n),i}},{key:"multiply",value:function(t,n,i){return n instanceof e?(i.x=t.x*n.x,i.y=t.y*n.y,i.z=t.z*n.z):(i.x=t.x*n,i.y=t.y*n,i.z=t.z*n),i}},{key:"divide",value:function(t,n,i){return n instanceof e?(i.x=t.x/n.x,i.y=t.y/n.y,i.z=t.z/n.z):(i.x=t.x/n,i.y=t.y/n,i.z=t.z/n),i}},{key:"cross",value:function(e,t,n){return n.x=e.y*t.z-e.z*t.y,n.y=e.z*t.x-e.x*t.z,n.z=e.x*t.y-e.y*t.x,n}},{key:"unit",value:function(e,t,n){var i=e.length();return t.x=e.x/i,t.y=e.y/i,t.z=e.z/i,t}},{key:"fromAngles",value:function(t,n){return new e(Math.cos(t)*Math.cos(n),Math.sin(n),Math.sin(t)*Math.cos(n))}},{key:"randomDirection",value:function(){return e.fromAngles(Math.random()*Math.PI*2,Math.asin(2*Math.random()-1))}},{key:"min",value:function(t,n,i){return new e(Math.min(t.x,n.x),Math.min(t.y,n.y),Math.min(t.z,n.z))}},{key:"max",value:function(t,n,i){return new e(Math.max(t.x,n.x),Math.max(t.y,n.y),Math.max(t.z,n.z))}},{key:"lerp",value:function(e,t,n){return t.subtract(e).multiply(n).add(e)}},{key:"fromArray",value:function(t){return new e(t[0],t[1],t[2])}},{key:"angleBetween",value:function(e,t,n){return e.angleTo(t)}},{key:"infinity",value:function(){return new e(1/0,1/0,1/0)}}]),e}(),m=function(){function e(t,n,i){Object(h.a)(this,e),this.x=t,this.y=n,this.z=i}return Object(f.a)(e,[{key:"toVec",value:function(){return y.fromArray(this.toArray())}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}}]),e}();!function(e){e.A="\u03b1",e.B="\u03b2",e.G="\u03b3",e.D="\u03b4",e.E="\u03b5",e.Z="\u03b6",e.H="\u03b7"}(i||(i={}));var v,x,b,p,j=function(){function e(){Object(h.a)(this,e),this.center=void 0,this.interactions=void 0,this.atoms=void 0,this.v=void 0,this.o=void 0,this.hash=void 0,this.name=void 0,this.sequenceNumber=void 0,this.polymerChainIdentifier=void 0,this.atoms=[],this.name="",this.sequenceNumber=-1,this.center=new m(-1,-1,-1),this.hash="",this.interactions=[],this.polymerChainIdentifier="",this.v=y.infinity(),this.o=y.infinity()}return Object(f.a)(e,[{key:"findAtomsByNames",value:function(e){var t=[];return this.atoms.forEach((function(n){-1!==e.indexOf(n.name)&&t.push(n)})),t.sort((function(t,n){return e.indexOf(t.name)-e.indexOf(n.name)})),t}}]),e}();!function(e){e.DA="DA",e.DG="DG",e.DC="DC",e.DT="DT"}(v||(v={})),function(e){e[e.A=0]="A",e[e.C=1]="C",e[e.G=2]="G",e[e.I=3]="I",e[e.U=4]="U"}(x||(x={})),function(e){e[e.Ala=0]="Ala",e[e.Arg=1]="Arg",e[e.Asn=2]="Asn",e[e.Asp=3]="Asp",e[e.Cys=4]="Cys",e[e.Glu=5]="Glu",e[e.Gln=6]="Gln",e[e.Gly=7]="Gly",e[e.His=8]="His",e[e.Ile=9]="Ile",e[e.Leu=10]="Leu",e[e.Lys=11]="Lys",e[e.Met=12]="Met",e[e.Phe=13]="Phe",e[e.Pro=14]="Pro",e[e.Ser=15]="Ser",e[e.Thr=16]="Thr",e[e.Trp=17]="Trp",e[e.Tyr=18]="Tyr",e[e.Val=19]="Val"}(b||(b={})),function(e){e.DNA="DNA",e.RNA="RNA",e.Protein="Protein",e.Unknown="Unknown"}(p||(p={}));var g=n(0),O={polymers:[],pdb:void 0,isLoading:!1,simpleStuffy:"",hashedNucleicAcidResidues:{},viz:{chain1:null,chain2:null},currentPDBId:"",selectedResidue:void 0,error:""},k=Object(r.createContext)([O,function(){}]),w=function(e,t){var n=t.type,i=t.payload;switch(n){case"resetState":return Object(c.a)({},O);default:if(!(n in e))throw new Error("".concat(n," not found in state"));e[n]=i}return Object(c.a)({},e)},A=function(e){var t=e.children,n=Object(r.useReducer)(w,O),i=Object(l.a)(n,2),a=i[0],s=i[1];return Object(g.jsx)(k.Provider,{value:[a,s],children:t})};function N(e){return e.residues.forEach((function(t,n){var i=new m(0,0,0);t.atoms.forEach((function(e){i.x+=e.coords.x,i.y+=e.coords.y,i.z+=e.coords.z})),i.x=i.x/t.atoms.length,i.y=i.y/t.atoms.length,i.z=i.z/t.atoms.length,e.residues[n].center=i})),e}function z(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2))}var D;!function(e){e[e.Threshold=0]="Threshold",e[e.HBond=1]="HBond"}(D||(D={}));var C=function(e){if(-1!=[p.DNA,p.RNA].indexOf(e.kind)){var t=["C2","C4","C6"];e.residues.forEach((function(e){var n=[];if(e.findAtomsByNames(t).forEach((function(e,t){n[t]=e.coords})),3===n.length){var i=y.fromArray(n[0].toArray()),r=y.fromArray(n[1].toArray()),a=y.fromArray(n[2].toArray()),s=r.subtract(i).cross(a.subtract(i)).normalize(),o=i.add(r).add(a).divide(3);e.v=s,e.o=o}}))}return e};var E,M=function(){function e(t){Object(h.a)(this,e),this.polymers=t,this.nucleicAcids=[],this.proteins=[],this.hasValidDNA=!1,this.hasValidRNA=!1,this.visualization={chain1:null,chain2:null},this.prepareObjects()}return Object(f.a)(e,[{key:"watsonCrickPairs",value:function(){if(this.nucleicAcids.length<=0)throw Error("Nucleic acids are not initialized");if(!(this.nucleicAcids.length>=2&&this.nucleicAcids[0].kind===p.DNA))throw Error("Correct DNA molecules were not found in provided structure");var e=this.nucleicAcids[0],t=this.nucleicAcids[1],n=this.calculateWatsonCrickPairs(e,t),i=this.calculateWatsonCrickPairs(t,e);i.reverse();var r=n;return i.forEach((function(e){if(1===e.length)r.push(e);else if(2===e.length){for(var t=!1,i=0;i<n.length;i++){var a=n[i];if(2===a.length&&a[0].hash===e[1].hash&&a[1].hash===e[0].hash){t=!0;break}}t||console.log("watsonCrickPairs: matching pair was not found ".concat(e[1].polymerChainIdentifier,":").concat(e[1].sequenceNumber).concat(e[1].name,"---").concat(e[0].polymerChainIdentifier,":").concat(e[0].sequenceNumber).concat(e[0].name),e)}})),r}},{key:"calculateWatsonCrickPairs",value:function(e,t){var n=[];return e.residues.forEach((function(e){var i,r=1/0;if(t.residues.forEach((function(t){var n=e.findAtomsByNames(["C2","C4","C6"]),a=[Math.abs(n[0].coords.toVec().subtract(t.o).dot(t.v)),Math.abs(n[1].coords.toVec().subtract(t.o).dot(t.v)),Math.abs(n[2].coords.toVec().subtract(t.o).dot(t.v))],s=t.findAtomsByNames(["C2","C4","C6"]),o=[Math.abs(s[0].coords.toVec().subtract(e.o).dot(e.v)),Math.abs(s[1].coords.toVec().subtract(e.o).dot(e.v)),Math.abs(s[2].coords.toVec().subtract(e.o).dot(e.v))],c=Math.max.apply(Math,o.concat(a));c<r&&(r=c,i=t)})),void 0!==i&&r<=1.42+Math.random()&&function(e,t){return e.name===v[v.DA]&&t.name===v[v.DT]||e.name===v[v.DT]&&t.name===v[v.DA]||e.name===v[v.DC]&&t.name===v[v.DG]||e.name===v[v.DG]&&t.name===v[v.DC]}(i,e)){n.push([e,i]);var a=i;console.log("Smallest distance: ",r,"".concat(e.polymerChainIdentifier,":").concat(e.sequenceNumber).concat(e.name),"".concat(a.polymerChainIdentifier,":").concat(a.sequenceNumber).concat(a.name))}else n.push([e]),console.log("No pair for: ".concat(e.polymerChainIdentifier,":").concat(e.sequenceNumber).concat(e.name,", smallest distance: ").concat(r))})),n}},{key:"prepareObjects",value:function(){this.nucleicAcids=this.findNucleicAcids(),this.proteins=this.findProteins(),this.nucleicAcids.forEach((function(e){return N(e)})),this.proteins.forEach((function(e){return N(e)}))}},{key:"findProteins",value:function(){return this.polymers.filter((function(e){return-1!==[p.Protein].indexOf(e.kind)}))}},{key:"findNucleicAcids",value:function(){return this.polymers.filter((function(e){return-1!==[p.DNA,p.RNA].indexOf(e.kind)}))}},{key:"thresholdInteractions",value:function(){var e=this;this.nucleicAcids.forEach((function(t,n){t.residues.forEach((function(t,i){e.proteins.forEach((function(r){r.residues.forEach((function(a){z(t.center,a.center)<=10&&t.atoms.forEach((function(t){a.atoms.forEach((function(s){var o,c=z(t.coords,s.coords);c<=5&&e.nucleicAcids[n].residues[i].interactions.push({residue:(o=a,{sequenceNumber:o.sequenceNumber,hash:o.hash,name:o.name,polymerChainIdentifier:o.polymerChainIdentifier}),type:D.Threshold,polymerKind:r.kind,meta:{distance:c}})}))}))}))}))}))}))}}]),e}(),I=n(4);!function(e){e.Pair="pair",e.Backbone="backbone"}(E||(E={}));var T,R,P=10,S=4;var B=(T={},Object(d.a)(T,v.DA,"#fcb331"),Object(d.a)(T,v.DT,"#5670fb"),Object(d.a)(T,v.DG,"#f63c37"),Object(d.a)(T,v.DC,"#03c907"),T),q="blue",G=(R={},Object(d.a)(R,v.DA,"red"),Object(d.a)(R,v.DT,"red"),Object(d.a)(R,v.DG,q),Object(d.a)(R,v.DC,q),R);function L(){var e=Object(r.useContext)(k),t=Object(l.a)(e,2),n=t[0],i=t[1],s=n.polymers,o=a.a.createRef(),d=a.a.createRef(),h=Object(r.useRef)(null),f=[];return s.filter((function(e){return-1!==[p.DNA,p.RNA].indexOf(e.kind)})).map((function(e){e.residues.map((function(e){return f.push.apply(f,Object(u.a)(e.atoms))}))})),Object(r.useEffect)((function(){if(o&&!(s.length<=0)){console.time("DNA_VIZ");var e,t=new M(s);try{e=t.watsonCrickPairs()}catch(p){return console.log(p),void i({type:"error",payload:p.toString()})}var n=t.nucleicAcids,r=[],a=[],u=n[0],l=n[1],d=function(e){return"".concat(e.polymerChainIdentifier,":").concat(e.name).concat(e.sequenceNumber)},f=function(e){e.residues.forEach((function(t,n){r.push(Object(c.a)(Object(c.a)({},t),{},{hash:t.hash,name:t.name.toString().slice(-1),id:d(t),color:B[t.name],group:y.indexOf(t.name)+1}));var i=e.residues;n>0&&n<i.length&&a.push({source:d(i[n-1]),target:d(t),value:1,color:"#494949",linkType:E.Backbone})}))},y=Object.values(v);f(u),f(l),e.forEach((function(e){var t=e[0];if(2===e.length){var n=e[1];a.push({source:d(n),target:d(t),value:1,color:G[t.name],linkType:E.Pair})}})),console.log("Vizualization data:",r,a);var m=[h.current.offsetWidth,h.current.offsetHeight],x=m[0],b=m[1];!function(e,t){var n=e.nodes,i=e.links,r=e.svgRef,a=e.dispatch,s=t.nodeId,o=void 0===s?function(e){return e.id}:s,c=(t.nodeGroups,t.nodeTitle),u=t.nodeFill,l=void 0===u?function(e){return void 0!==e.color?e.color:"currentColor"}:u,d=t.nodeStroke,h=void 0===d?"#fff":d,f=t.nodeStrokeWidth,y=void 0===f?1.5:f,m=t.nodeStrokeOpacity,v=void 0===m?1:m,x=t.nodeRadius,b=void 0===x?10:x,p=t.nodeStrength,j=t.linkStroke,g=void 0===j?function(e){return void 0!==e.color?e.color:"#444"}:j,O=t.linkStrokeOpacity,k=void 0===O?.6:O,w=t.linkStrokeWidth,A=void 0===w?1.5:w,N=t.linkStrokeLinecap,z=void 0===N?"round":N,D=t.linkStrength,C=void 0===D?2:D,M=t.width,T=void 0===M?640:M,R=t.height,B=void 0===R?400:R,q=t.invalidation,G=n,L=i,V=I.e(n,o).map((function(e){return null!==e&&"object"===typeof e?e.valueOf():e}));void 0===c&&(c=function(e,t){return V[t]});var F="function"!==typeof A?null:I.e(i,A);n=G,i=L;var _=I.c(),W=I.b(i).id((function(e){var t=e.index;return V[t]})).distance((function(e,t){return L[t].linkType===E.Backbone?5:70})).strength((function(e,t){return L[t].linkType===E.Backbone?5e3:1}));void 0!==p&&_.strength(p),void 0!==C&&W.strength(C);var H=I.d(n).force("link",W).force("charge",_).on("tick",(function(){Z.attr("x1",(function(e){return e.source.x})).attr("y1",(function(e){return e.source.y})).attr("x2",(function(e){return e.target.x})).attr("y2",(function(e){return e.target.y})),Y.attr("transform",(function(e){return"translate(".concat(e.x,", ").concat(e.y,")")}))})),K=I.f(r).attr("width",T).attr("height",B).attr("viewBox",[-T/2,-B/2,T,B]).attr("style","max-width: 100%; height: auto; height: intrinsic;");K.html("");var U=K.append("g"),Z=U.append("g").attr("stroke-opacity",k).attr("stroke-width","function"!==typeof A?A:null).attr("stroke-linecap",z).selectAll("line").data(i).join("line").attr("stroke-dasharray",(function(e){return"pair"===e.linkType?"4":null})).attr("stroke",g),Y=U.append("g").selectAll("g").data(n).enter().append("g").call(function(e){return I.a().on("start",(function(t){t.active||e.alphaTarget(.3).restart(),t.subject.fx=t.subject.x,t.subject.fy=t.subject.y})).on("drag",(function(e){e.subject.fx=e.x,e.subject.fy=e.y})).on("end",(function(t){t.active||e.alphaTarget(0),t.subject.fx=null,t.subject.fy=null}))}(H)),J=Y.append("circle").attr("stroke",h).attr("stroke-opacity",v).attr("stroke-width",y).attr("fill",l).attr("r",b),Q=new Date;Y.on("mouseover",(function(e,t){I.f(this).select("circle").attr("r",$(2*b)),(new Date).getTime()-Q.getTime()>250&&(a({type:"selectedResidue",payload:t}),Q=new Date)})).on("mouseout",(function(e,t){I.f(this).select("circle").attr("r",$(b)),(new Date).getTime()-Q.getTime()>50&&a({type:"selectedResidue",payload:void 0})}));var X=Y.append("text").text((function(e){return e.name})).attr("text-anchor","middle").attr("font-size",P).attr("y",S).attr("class","svg-graph-text");F&&Z.attr("stroke-width",(function(e){return F[e.index]})),null!=q&&q.then((function(){return H.stop()}));var $=function(e){return te?e/te:e},ee=void 0,te=void 0,ne=I.g().on("zoom",(function(e){U.attr("transform",ee=e.transform),ee&&(te=Math.sqrt(ee.k),U.style("stroke-width",3/te),J.attr("r",b/te).attr("stroke-width",y/te),X.attr("font-size",P/te).attr("y",S/te))}));K.call(ne).call(ne.transform,I.h),Object.assign(K.node(),{scales:{color:null}})}({nodes:r,links:a,svgRef:o.current,dispatch:i},{width:x,height:b}),console.timeEnd("DNA_VIZ")}}),[s]),Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)("div",{children:n.simpleStuffy}),Object(g.jsxs)("div",{className:"p-5 flex items-center flex-col h-full",ref:h,children:[Object(g.jsxs)("div",{className:"min-w-full h-full relative",children:[Object(g.jsx)("svg",{ref:o}),n.selectedResidue&&Object(g.jsxs)("div",{className:"\r text-xs p-4\r absolute bottom-[10px] right-[10px]\r w-[50%] h-[100px] bg-indigo-400\r overflow-auto text-white rounded-lg\r ",children:[Object(g.jsxs)("div",{children:["Chain: ",n.selectedResidue.polymerChainIdentifier]}),Object(g.jsxs)("div",{children:["Residue: ",n.selectedResidue.name,":",n.selectedResidue.sequenceNumber]}),Object(g.jsxs)("div",{children:["Interactions:"," ",n.selectedResidue.interactions.map((function(e){return Object(g.jsxs)("div",{children:[e.polymerKind," - ",e.residue]})}))]})]})]}),Object(g.jsx)("div",{ref:d,style:{position:"absolute",opacity:0,background:"#fff"}})]})]})}var V=n(3),F=n.n(V),_=n(13),W=n(30),H=n.n(W),K=n(22),U=n.n(K),Z=function(){function e(t){Object(h.a)(this,e),this.file=void 0,void 0!==t&&(this.file=t)}return Object(f.a)(e,[{key:"readData",value:function(){var e=Object(_.a)(F.a.mark((function e(){var t;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!=this.file){e.next=2;break}throw Error("file not provided");case 2:return e.next=4,this.file.text();case 4:return t=e.sent,e.abrupt("return",this.format(t));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"format",value:function(e){return{raw:this.formatText(e),polymers:this.formatPolymers(e)}}},{key:"formatText",value:function(e){return e.split("\n").map((function(e,t){return t.toString()+". "+e})).join("\n")}},{key:"formatPolymers",value:function(e){var t,n=[],i=function(){return{chainIdentifier:"",residues:[],kind:p.Unknown}},r=function(){return new j},a=function(){o.hash=U()(o),s.residues.push(o)},s=i(),o=r(),c=function(e){var t,n=(t={},Object(d.a)(t,p.DNA,0),Object(d.a)(t,p.RNA,0),Object(d.a)(t,p.Protein,0),t);return void 0===e?n:[n,Object.keys(e).reduce((function(t,n){return e[t]>e[n]?t:n}))]},h=c(),f=[],b=!1,g=function(){t={chains:[],rotations:[],translations:[y.infinity()]}};return e.split("\n").forEach((function(e){if(e.startsWith("ATOM")||e.startsWith("HETATM")){var d=parseFloat(e.slice(30,38).trim()),j=parseFloat(e.slice(38,46).trim()),O=parseFloat(e.slice(46,54).trim()),k=e.slice(12,16).trim(),w=e.slice(17,20).trim(),A=e.slice(76,78).trim(),N=parseInt(e.slice(22,26).trim()),z=e.slice(21,22);s.chainIdentifier=z;var D={coords:new m(d,j,O),name:k,element:A,residueName:w,residueSequenceNumber:N};h[function(e){switch(!0){case e.residueName in v:return p.DNA;case e.residueName in x:return p.RNA;default:return p.Protein}}(D)]++,-1===o.sequenceNumber&&(o.name=D.residueName,o.sequenceNumber=N,o.polymerChainIdentifier=z),N!==o.sequenceNumber&&(a(),(o=r()).name=D.residueName,o.sequenceNumber=N,o.polymerChainIdentifier=z),o.atoms.push(D)}if(e.startsWith("TER")){a();var E=c(h),M=Object(l.a)(E,2),I=M[0],T=M[1];h=I,s.kind=T,s=C(s),n.push(s),s=i(),o=r()}if(e.startsWith("REMARK 350")){b=!0;if(["REMARK 350 APPLY THE FOLLOWING TO CHAINS: ","REMARK 350                    AND CHAINS:"].forEach((function(n,i){if(e.startsWith(n)){var r,a=e.trim().slice(n.length-1,e.length).toString().replaceAll(" ","").split(",");if(0===i&&(g(),t.chains.length>0&&f.push(t)),a.length>0)(r=t.chains).push.apply(r,Object(u.a)(a))}})),e.startsWith("REMARK 350   BIOMT")){var R=e.replace("REMARK 350   BIOMT","").match(new RegExp(/(\d{1})\s*(\d{1})\s*([+-]?[0-9]*[.]?[0-9]+)\s*([+-]?[0-9]*[.]?[0-9]+)\s*([+-]?[0-9]*[.]?[0-9]+)\s*([+-]?[0-9]*[.]?[0-9]+)/));if(null!=R&&7===R.length){R=R.slice(1);var P=parseInt(R[1])-1,S=parseInt(R[0])-1,B=[parseFloat(R[2]),parseFloat(R[3]),parseFloat(R[4])],q=parseFloat(R[5]);"undefined"===typeof t.translations[P]&&(t.translations[P]=y.infinity()),t.translations[P].setIndex(S,q),Array.isArray(t.rotations[P])||(t.rotations[P]=[]),t.rotations[P][S]=B}}}else b&&(f.push(t),g()),b=!1})),f.forEach((function(e){var t=n.filter((function(t){return-1!==e.chains.indexOf(t.chainIdentifier)})),i=e.rotations.slice(1),r=e.translations.slice(1);i.forEach((function(e,i){t.forEach((function(t){var a=H()(t,{includeNonEnumerable:!0});a.chainIdentifier=a.chainIdentifier+(i+1).toString(),a.generatedFromTransform=!0,a.residues.forEach((function(t,n){t.polymerChainIdentifier=a.chainIdentifier,t.atoms.forEach((function(n,a){var s=n.coords.toVec(),o=y.infinity();console.log("Coorinates before:",s),o.x=s.x*e[0][0]+s.y*e[0][1]+s.z*e[0][2],o.y=s.x*e[1][0]+s.y*e[1][1]+s.z*e[1][2],o.z=s.x*e[2][0]+s.y*e[2][1]+s.z*e[2][2];var c=r[i];o=o.add(c),console.log("Coords after:",o),console.log("Distance between atoms: ",o.distanceTo(s)),n.coords=o.toCoord(),t.atoms[a]=n})),t.hash=U()(t),a.residues[n]=t})),a=C(a),n.push(a)}))}))})),console.log("Transformations:",f),console.log("Result after translation",n),n}}]),e}(),Y=function(){var e=Object(_.a)(F.a.mark((function e(t){var n,i;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://files.rcsb.org/download/".concat(t,".pdb"));case 2:return n=e.sent,e.next=5,n.text();case 5:return i=e.sent,e.abrupt("return",i);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function J(){var e=Object(r.useContext)(k),t=Object(l.a)(e,2),n=t[0],i=t[1],a=function(){i({type:"isLoading",payload:!0})},s=function(){i({type:"isLoading",payload:!1})},o=function(e){i({type:"pdb",payload:e})},c=function(e){i({type:"currentPDBId",payload:e})},u=function(e){i({type:"polymers",payload:e})},d=function(){i({type:"resetState",payload:null})},h=function(){var e=Object(_.a)(F.a.mark((function e(t){var n;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d(),a(),e.t0=new Z,e.next=5,Y(t);case 5:e.t1=e.sent,n=e.t0.format.call(e.t0,e.t1),o(n),u(n.polymers),c(t),s();case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(r.useEffect)((function(){var e=new URLSearchParams(window.location.search).get("id");console.log("ID",e),null!==e&&h(e)}),[]);var f,y,m=function(){var e=Object(_.a)(F.a.mark((function e(t){var n,i,r;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(i=null===(n=t.target.files)||void 0===n?void 0:n.item(0))){e.next=14;break}return d(),a(),console.time("TIME_TO_PARSE_EVERYTHING"),console.time("TIME_TO_PARSE_PDB"),e.next=8,new Z(i).readData();case 8:r=e.sent,console.timeEnd("TIME_TO_PARSE_PDB"),o(r),u(r.polymers),console.timeEnd("TIME_TO_PARSE_EVERYTHING"),setTimeout(s,2e3);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();n.polymers.length>0&&(f=Object(g.jsxs)("div",{className:"mt-5",children:[Object(g.jsx)("div",{className:"mb-1",children:"Provided input file"}),Object(g.jsx)("textarea",{className:"text-sm w-full border h-96 border-blue-100",value:null===(y=n.pdb)||void 0===y?void 0:y.raw,readOnly:!0})]}));var v=Object(r.useRef)(null),x=function(){var e,t=null===(e=v.current)||void 0===e?void 0:e.value;t&&h(t)};return Object(g.jsxs)("div",{className:"p-5 max-h-screen overflow-auto break-words",children:[!n.isLoading&&Object(g.jsxs)("div",{children:[n.error.length>0&&Object(g.jsx)("div",{className:"mb-4",children:Object(g.jsxs)("div",{className:"text-red-700 font-bold text-lg",children:["Something went wrong: ",n.error]})}),void 0===n.pdb&&Object(g.jsx)("div",{className:"text-sm text-gray-600 mb-4 bg-red-200 p-2",children:"Choose a PDB file which contains DNA/RNA with Proteins"}),Object(g.jsxs)("div",{children:[n.currentPDBId.length>0&&Object(g.jsxs)("div",{className:"mb-4",children:["Currently selected PDB ID:",Object(g.jsx)("b",{children:n.currentPDBId.toUpperCase()})]}),Object(g.jsxs)("div",{className:"mb-4",children:[Object(g.jsxs)("div",{className:"text-normal font-bold text-gray-600 mb-2",children:["Enter PDB file ID:",Object(g.jsxs)("div",{className:"text-xs font-normal",children:["PDB file should contain ",Object(g.jsx)("b",{children:"DNA/RNA"})," structures"]})]}),Object(g.jsxs)("div",{className:"flex flex-row max-w-full",children:[Object(g.jsx)("input",{onKeyPress:function(e){"Enter"===e.key&&x()},ref:v,placeholder:"1ZS4",className:"border-r-0 outline-none ring-indigo-200 focus:ring-2 transition-all block py-1 px-2 outline-0 border border-indigo-300 rounded rounded-tr-none rounded-br-none"}),Object(g.jsx)("button",{onClick:x,className:"bg-indigo-400 border-l-0 text-white font-bold text-sm ring-indigo-200 focus:ring-2 hover:bg-indigo-600 transition-all w-[100px]  block rounded rounded-tl-none rounded-bl-none border border-indigo-300",children:"GO"})]})]}),Object(g.jsxs)("div",{className:"text-normal font-bold text-gray-600 mb-2",children:["Or choose a PDB file to display:",Object(g.jsxs)("div",{className:"text-xs font-normal",children:["PDB file should contain ",Object(g.jsx)("b",{children:"DNA/RNA"})," structures"]})]}),Object(g.jsx)("input",{type:"file",onChange:m,className:"max-w-full"})]})]}),f,n.pdb&&Object(g.jsxs)("div",{children:["Polymers from input:",n.polymers.map((function(e,t){var n=e.residues,i=e.chainIdentifier,r=e.kind;return Object(g.jsxs)("div",{className:"ml-2",children:["Chain:"," ",Object(g.jsxs)("b",{children:[i," (",r,")"]}),Object(g.jsx)("div",{className:"ml-2",children:n.map((function(e,t){return Object(g.jsxs)("span",{children:[e.name," \xa0"]},t)}))})]},t)}))]})]})}n(116);var Q=function(){return Object(g.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[Object(g.jsx)("div",{className:"text-white font-bold",children:"Loading"}),Object(g.jsxs)("div",{className:"lds-roller",children:[Object(g.jsx)("div",{}),Object(g.jsx)("div",{}),Object(g.jsx)("div",{}),Object(g.jsx)("div",{}),Object(g.jsx)("div",{}),Object(g.jsx)("div",{}),Object(g.jsx)("div",{}),Object(g.jsx)("div",{})]})]})};function X(){var e=Object(r.useContext)(k)[0];return Object(g.jsxs)("div",{className:"w-full flex flex-row",children:[!0===e.isLoading&&Object(g.jsx)("div",{className:"fixed w-screen min-h-screen top-0 left-0 flex items-center justify-center z-50  h-full",style:{backgroundColor:"rgba(0,0,0,0.75)"},children:Object(g.jsx)(Q,{})}),Object(g.jsx)("div",{className:"z-10 w-9/12 bg-indigo-200 min-h-full h-screen",children:Object(g.jsx)(L,{})}),Object(g.jsx)("div",{className:"z-10 w-3/12",children:Object(g.jsx)(J,{})})]})}function $(e){var t=e.children;return Object(g.jsx)(A,{children:t})}var ee=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,118)).then((function(t){var n=t.getCLS,i=t.getFID,r=t.getFCP,a=t.getLCP,s=t.getTTFB;n(e),i(e),r(e),a(e),s(e)}))};o.a.render(Object(g.jsx)(a.a.StrictMode,{children:Object(g.jsx)($,{children:Object(g.jsx)(X,{})})}),document.getElementById("root")),ee()}},[[117,1,2]]]);
//# sourceMappingURL=main.5af570da.chunk.js.map